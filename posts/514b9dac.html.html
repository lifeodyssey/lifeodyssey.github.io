<!DOCTYPE html><html class="font-sans scroll-smooth" lang=zh-CN><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><link href=/icons/favicon.svg rel=icon type=image/svg+xml><title>py6s | 乔克叔叔的床边故事</title><meta content="之前一直想方设法跨过去的事情今天终于要开始搞了 我今天终于才弄明白6到底是怎么做大气校正的 6S的全名是Second Simulation of a Satellite Signal in the Solar Spectrum vector..." name=description><meta content=周大侠 name=author><meta content="Astro v5.13.7" name=generator><meta content="oklch(96% 0.005 298)" name=theme-color><link href=/fonts/EarlySummer-VF-Split/EarlySummer-VF-Subset.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Snell-Black-SF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Snell-Bold-SF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/STIX-VF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/STIX-Italic-VF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/_astro/katex.min.COXD5gRV.css rel=stylesheet media=print onload="this.media=&#34;all&#34;"><link href=https://lifeodyssey.github.io/posts/514b9dac.html.html rel=canonical><link href=/sitemap-index.xml rel=sitemap><link href=/rss.xml rel=alternate type=application/rss+xml title="RSS Feed"><link href=/atom.xml rel=alternate type=application/atom+xml title="Atom Feed"><link href=https://lifeodyssey.github.io rel=alternate hreflang=zh><link href=https://lifeodyssey.github.io/en/ rel=alternate hreflang=en><link href=https://lifeodyssey.github.io/ja/ rel=alternate hreflang=ja><meta content=article property=og:type><meta content=https://lifeodyssey.github.io/posts/514b9dac.html.html property=og:url><meta content="py6s | 乔克叔叔的床边故事" property=og:title><meta content="之前一直想方设法跨过去的事情今天终于要开始搞了 我今天终于才弄明白6到底是怎么做大气校正的 6S的全名是Second Simulation of a Satellite Signal in the Solar Spectrum vector..." property=og:description><meta content=https://lifeodyssey.github.io/og/514b9dac.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=true name=astro-view-transitions-enabled><meta content=none name=astro-view-transitions-fallback><script type=module src=/_astro/ClientRouter.astro_astro_type_script_index_0_lang.1k2cUud7.js></script><script>!function(){function e(e=document){const t=function(){const e=localStorage.getItem("theme");return!!e&&"dark"===e}();e.documentElement.classList.toggle("dark",t);const n=e.head.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",t?"oklch(22% 0.005 298)":"oklch(96% 0.005 298)")}function t(e=document){const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches||!("startViewTransition"in e);e.documentElement.classList.toggle("reduce-motion",t)}document.addEventListener("astro:before-swap",(({newDocument:n})=>{e(n),t(n)})),e(),t()}()</script><link href=/_astro/_about_.Dzb1Me_E.css rel=stylesheet><link href=/_astro/_posts_slug_.CM85RmC-.css rel=stylesheet><script type=module src=/_astro/page.BNYwb576.js></script><script>!function(t,e,n,r){(window.crossOriginIsolated||navigator.serviceWorker)&&((r=t[e]=Object.assign(t[e]||{},{lib:"/~partytown/",debug:!1}))[n]=(r[n]||[]).concat(["dataLayer.push","gtag"]))}(window,"partytown","forward");const tp={preserveBehavior:!1},ep=t=>{if("string"==typeof t)return[t,tp];const[e,n=tp]=t;return[e,{...tp,...n}]},n=Object.freeze((()=>{const t=new Set;let e=[];do{Object.getOwnPropertyNames(e).forEach((n=>{"function"==typeof e[n]&&t.add(n)}))}while((e=Object.getPrototypeOf(e))!==Object.prototype);return Array.from(t)})());!function(t,e,r,o,i,a,s,c,d,p,l=t,u){function f(){u||(u=1,"/"==(s=(a.lib||"/~partytown/")+(a.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),o!=t?o.dispatchEvent(new CustomEvent("pt1",{detail:t})):(c=setTimeout(w,(null==a?void 0:a.fallbackTimeout)||1e4),e.addEventListener("pt0",h),i?y(1):r.serviceWorker?r.serviceWorker.register(s+(a.swPath||"partytown-sw.js"),{scope:s}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):w())))}function y(n){p=e.createElement(n?"script":"iframe"),t._pttab=Date.now(),n||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=s+"partytown-"+(n?"atomics.js?v=0.11.1":"sandbox-sw.html?"+t._pttab),e.querySelector(a.sandboxParent||"body").appendChild(p)}function w(n,r){for(h(),o==t&&(a.forward||[]).map((function(e){const[n]=ep(e);delete t[n.split(".")[0]]})),n=0;n<d.length;n++)(r=e.createElement("script")).innerHTML=d[n].innerHTML,r.nonce=a.nonce,e.head.appendChild(r);p&&p.parentNode.removeChild(p)}function h(){clearTimeout(c)}a=t.partytown||{},o==t&&(a.forward||[]).map((function(e){const[r,{preserveBehavior:o}]=ep(e);l=t,r.split(".").map((function(e,r,i){var a;l=l[i[r]]=r+1<i.length?l[i[r]]||(a=i[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(o){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,i);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(i,arguments),n}})()}))})),"complete"==e.readyState?f():(t.addEventListener("DOMContentLoaded",f),t.addEventListener("load",f))}(window,document,navigator,top,window.crossOriginIsolated),document.addEventListener("astro:before-swap",(t=>{let e=document.body.querySelector("iframe[src*='/~partytown/']");e&&t.newDocument.body.append(e)}))</script><style>[data-astro-transition-scope=astro-va26yt7w-1]{view-transition-name:post-514b9dac-zh}@layer astro{::view-transition-old(post-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(post-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(post-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(post-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-aqc54ihn-2]{view-transition-name:time-514b9dac-zh}@layer astro{::view-transition-old(time-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(time-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(time-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(time-514b9dac-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-wif6pdce-3]{view-transition-name:site-title-zh}@layer astro{::view-transition-old(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style></head><body><div class="max-w-205.848 min-h-dvh min-h-vh mx-auto w-full" lg="mx-[max(5.75rem,calc(50vw-34.25rem))] my-20 max-w-[min(calc(75vw-16rem),44rem)] min-h-full p-0" p="x-[min(7.25vw,3.731rem)] y-10"><header class="cjk:tracking-0.02em lg:uno-desktop-column lg:top-20 mb-10.8"><h2 class="c-secondary font-bold font-title lg:c-primary lg:mb-1.8 lg:mt-0 lg:text-9 mb-2.8 mt-3 text-5.375"><div class="inline-block box-content pr-1" data-astro-transition-scope=astro-wif6pdce-3 data-disable-theme-transition><a href=/ id=site-title-link>乔克叔叔的床边故事</a></div></h2></header><nav aria-label="Site Navigation" class="cjk:tracking-0.02em lg:uno-desktop-column font-navbar font-semibold hidden leading-2.45em lg:block lg:bottom-[min(9.04rem+3.85vw,12.5rem)] lg:text-4 mb-10.5 text-3.6"><ul><li><a href=/ class="after:bottom-0.7em c-primary font-bold highlight-static">文章</a></li><li><a href=/tags/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">标签</a></li><li><a href=/about/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">关于</a></li><li><a href=/search/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">Search</a></li></ul></nav><main class=mb-10><article class=heti><div class=relative><button aria-label="Go back" class=hidden id=back-button lg="absolute left--10 top-3.8 block aspect-square w-4.5 c-secondary/40 transition-colors ease-out hover:c-secondary/80 active:scale-90!"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d=M17.8.7L4,12l13.8,11.4.7-.9L7.2,12,18.5,1.5l-.7-.8Z /></svg></button><script type=module>function e(t){if(!(t.target instanceof Element?t.target:null)?.closest("#back-button"))return;if(window.history.length>1)return void window.history.back();const e=document.getElementById("site-title-link");e&&e.click()}document.addEventListener("click",e,{passive:!0})</script><h1 class=post-title><span data-astro-transition-scope=astro-va26yt7w-1 data-disable-theme-transition>py6s</span></h1></div><div class="c-primary block font-time mb-17.2" data-astro-transition-scope=astro-aqc54ihn-2 data-disable-theme-transition id=post-date><time datetime=2021-12-10>2021-12-10 </time><span class=ml-1.75>8 min</span></div><script type=module>let s=null,i=null;function g(){if(!(window.innerWidth>=1536))return;const t=document.getElementById("toc-accordion-content");if(!t)return;const e=t.getElementsByTagName("a");if(0===e.length)return;const n=Array.from(e,(t=>t)),o=n.some((t=>t.classList.contains("toc-links-h2")))?"toc-links-h2":"toc-links-h3",c=new Map;n.forEach((t=>{const e=t.getAttribute("href")?.substring(1);e&&c.set(e,t)}));let r=null;function l(t){t!==r&&(n.forEach((t=>{t.classList.remove("toc-link-active")})),t.classList.add("toc-link-active"),t.classList.contains(o)||function(t){for(let e=n.indexOf(t)-1;e>=0;e--){const t=n[e];if(t.classList.contains(o)){t.classList.add("toc-link-active");break}}}(t),r=t,t.scrollIntoView({behavior:"smooth",block:"nearest"}))}s=new IntersectionObserver((t=>{const e=t.find((t=>t.isIntersecting))?.target?.id;if(e){const t=c.get(e);t&&l(t)}}),{rootMargin:"0% 0% -66% 0%",threshold:[.4]}),Array.from(document.querySelectorAll("h2, h3, h4")).filter((t=>t.id&&"footnotes"!==t.id)).forEach((t=>s?.observe(t)));const a=document.getElementById("post-copyright");a&&(i=new IntersectionObserver((t=>{!t[0].isIntersecting&&t[0].boundingClientRect.top<0&&(n.forEach((t=>t.classList.remove("toc-link-active"))),r=null)}),{rootMargin:"0px 0px 0px 0px",threshold:0}),i?.observe(a),n.length>0&&l(n[0]))}function m(){s?.disconnect(),i?.disconnect(),s=null,i=null}document.addEventListener("astro:after-swap",g),document.addEventListener("astro:before-swap",m),g()</script><div id=post-content><p>之前一直想方设法跨过去的事情今天终于要开始搞了</p><h1 id=6s介绍>6S介绍<a href=#6s介绍 class=heading-anchor-link aria-label="Link to 6S介绍"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M2.6 21.4c2 2 5.9 2.9 8.9 0l3.5-3.5-1-1-3.5 3.5c-1.4 1.4-4.2 1.9-6.4-.3s-1.8-5-.3-6.4l3.5-3.5-1-1-3.5 3.5c-3 3-2 6.9 0 8.9ZM21.4 2.6c2 2 2.9 5.9 0 8.9L17.9 15l-1-1 3.5-3.5c1.4-1.4 1.9-4.2-.3-6.4s-5-1.8-6.4-.3l-3.5 3.5-1-1 3.5-3.5c3-3 6.9-2 8.9 0Z"></path><path d="m8.01 14.97 6.93-6.93 1.061 1.06-6.93 6.93z"></path></svg></a></h1><p>我今天终于才弄明白6到底是怎么做大气校正的</p><p>6S的全名是Second Simulation of a Satellite Signal in the Solar Spectrum vector code，所以他不是通过输入的遥感影像来算出来的，而是在选定一个大气环境下，通过辐射传输模拟算出来辐亮度值，然后把观测得到的辐亮度值减去这个算出来的。</p><p>而不是像水色里的步骤一样，通过各种假设和经验计算出来辐亮度，再减去辐亮度</p><p>然后再来搞清楚一下我要弄的东西</p><p>我这里要复现的是High-frequency observation of floating algae from AHI on Himawari-8这篇文章</p><blockquote><p>The calibration parameters were applied to raw counts to produce the top-of-atmosphere radiance (<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>L</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub></mrow><annotation encoding=application/x-tex>L_{TOA}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>) and reflectance (<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>R</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub></mrow><annotation encoding=application/x-tex>R_{TOA}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>), and then (<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>R</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub></mrow><annotation encoding=application/x-tex>R_{TOA}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>) was converted to Rayleigh-corrected reflectance(<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>R</mi><mrow><mi>r</mi><mi>c</mi></mrow></msub></mrow><annotation encoding=application/x-tex>R_{rc}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">rc</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>) following Hu et al. (2004):</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>R</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub><mo>=</mo><mi>π</mi><msub><mi>L</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub><mi mathvariant=normal>/</mi><mo stretchy=false>(</mo><msub><mi>F</mi><mn>0</mn></msub><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy=false>(</mo><msub><mi>θ</mi><mn>0</mn></msub><mo stretchy=false>)</mo><mo stretchy=false>)</mo><mspace linebreak=newline></mspace><msub><mi>R</mi><mrow><mi>r</mi><mi>c</mi></mrow></msub><mo>=</mo><msub><mi>R</mi><mrow><mi>T</mi><mi>O</mi><mi>A</mi></mrow></msub><mo>−</mo><msub><mi>R</mi><mi>r</mi></msub></mrow><annotation encoding=application/x-tex>R_{TOA}=\pi L_{TOA}/(F_0cos(\theta_0))\\ R_{rc}=R_{TOA}-R_r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mord mathnormal" style=margin-right:.03588em>π</span><span class=mord><span class="mord mathnormal">L</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord>/</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>F</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class="mord mathnormal">cos</span><span class=mopen>(</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>))</span></span><span class="mspace newline"></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal">rc</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3283em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight mathnormal" style=margin-right:.02778em>TO</span><span class="mord mtight mathnormal">A</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222em></span><span class=mbin>−</span><span class=mspace style=margin-right:.2222em></span></span><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight mathnormal" style=margin-right:.02778em>r</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span><p>where <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>F</mi><mn>0</mn></msub></mrow><annotation encoding=application/x-tex>F_0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>F</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.1389em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> is the extraterrestrial solar irradiance, <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>θ</mi><mn>0</mn></msub></mrow><annotation encoding=application/x-tex>θ_0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8444em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>θ</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3011em><span style=top:-2.55em;margin-left:-.0278em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> is sun zenith angle; <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>R</mi><mi>r</mi></msub></mrow><annotation encoding=application/x-tex>R_r</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.00773em>R</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0077em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight mathnormal" style=margin-right:.02778em>r</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> is Rayleigh reflectance estimated with the 6S model (Vermote et al.,1997) modified for AHI. The modification was simply to apply the spectral response function of all bands of AHI into the original 6S model. The required inputs to the 6S model, for example, barometric pressure, were obtained from ECMWF (<a href="https://apps.ecmwf.int/datasets/data/interim-full-daily/levtype=sfc/" rel="nofollow noopener noreferrer external" target=_blank>https://apps.ecmwf.int/datasets/data/interim-full-daily/levtype=sfc/</a>).</p></blockquote><p>一个个来</p><p>首先是从0级数据到TOA.</p><p>在<a href=https://www.eorc.jaxa.jp/ptree/userguide.html rel="nofollow noopener noreferrer external" target=_blank>这个</a>页面看到从1级数据开始就是albedo了，所以还是要从0级数据开始</p><p>问题是转换公式是什么呢。</p><p>于是我又去看了看他提到的那篇hu2004，但是没找到</p><p>回头又看了眼他前面说的那句</p><blockquote><p>containing all the necessary metadata for calibration and projection parameters in the header section, with the raw binary data stored in the main HSD block.</p></blockquote><p>哦那就不用管了，为了确认我打开<a href=https://www.data.jma.go.jp/mscweb/en/himawari89/space_segment/hsd_sample/HS_D_users_guide_en_v13.pdf rel="nofollow noopener noreferrer external" target=_blank>这个页面</a>看了眼</p><figure><img alt=image-20211216174336134 src=C:/Users/zhenjia/AppData/Roaming/Typora/typora-user-images/image-20211216174336134.png><figcaption>image-20211216174336134</figcaption></figure><p>然后还有一个这个</p><figure><img alt=image-20211217174759219 src=C:/Users/zhenjia/AppData/Roaming/Typora/typora-user-images/image-20211217174759219.png><figcaption>image-20211217174759219</figcaption></figure><p>问题来了，这一步算出来的是albedo，但是我要用的是reflectance，这俩一样吗？</p><p>我查了<a href=https://gis.stackexchange.com/questions/36726/difference-between-albedo-and-surface-reflectance rel="nofollow noopener noreferrer external" target=_blank>这个</a>回答，没看懂，后来想想，去查单位呗</p><p>Radiance的单位是<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>W</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mi>μ</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><msup><mi>r</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=application/x-tex>Wm^{-2}\mu m^{-1}sr^{-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1.0085em;vertical-align:-.1944em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">μ</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>,pi和那个cos都是没有单位的</p><p>翻到了一篇<a href=https://aslopubs.onlinelibrary.wiley.com/doi/pdf/10.4319/lo.1990.35.8.1657 rel="nofollow noopener noreferrer external" target=_blank>古老的文献</a>，里面给出的单位是</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>W</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mi>n</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=application/x-tex>W m^{-2} nm^{-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141em></span><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></p><p>因为是band averaged（spectral mean）所以有个nm-1正常，和irradiance的单位就差了个这个</p><p>所以那个最终的单位是</p><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mfrac><mrow><mi>W</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mi>μ</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>s</mi><msup><mi>r</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><mrow><mi>W</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mi>n</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac><mspace linebreak=newline></mspace><mo>=</mo><mi>s</mi><msup><mi>r</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=application/x-tex>\frac{Wm^{-2}\mu m^{-1}sr^{-1}}{W m^{-2} nm^{-1}} \\ =sr^{-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.1771em;vertical-align:-.686em></span><span class=mord><span class="mopen nulldelimiter"></span><span class=mfrac><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:1.4911em><span style=top:-2.314em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.7401em><span style=top:-2.989em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style=top:-3.23em><span class=pstrut style=height:3em></span><span class=frac-line style=border-bottom-width:.04em></span></span><span style=top:-3.677em><span class=pstrut style=height:3em></span><span class=mord><span class="mord mathnormal" style=margin-right:.13889em>W</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">μ</span><span class=mord><span class="mord mathnormal">m</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">s</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.686em><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class=base><span class=strut style=height:.3669em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2778em></span></span><span class=base><span class=strut style=height:.8641em></span><span class="mord mathnormal">s</span><span class=mord><span class="mord mathnormal" style=margin-right:.02778em>r</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8641em><span style=top:-3.113em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span><p>对我来说差一个角度值，这个角度值只能是Cos(theta0)来的</p><p>我就很费解，这个cos(theta0)是从哪儿提供的角度呢</p><p>所以这个肯定是不一样。</p><p>最后在发邮件问了他们的工作人员之后，终于得到了这个数值。</p><p>在<a href=https://www.data.jma.go.jp/mscweb/data/monitoring/gsics/vis/techinfo_visvical.html rel="nofollow noopener noreferrer external" target=_blank>这个</a>页面，算出来的单位也是对的</p><p>##　6s</p><blockquote><p>Rr is Rayleigh reflectance estimated with the 6S mode</p></blockquote><p>在用咕咕噜搜了半天之后，终于找到作者本人写的怎么算的文章了，在<a href=https://blog.rtwilson.com/calculating-rayleigh-reflectance-using-py6s/ rel="nofollow noopener noreferrer external" target=_blank>这里</a>。</p><p>（百度和bing完全搜不到这篇文章，国内还把bing给禁了，那不就是拿百度给民众喂屎）</p><p>以下是对原文的翻译+自我理解</p><p>首先我们要理解，什么是瑞利反射。</p><p>瑞利反射是单独由大其中的分子造成的反射，而6s并不能单独计算这一项，她能计算的是所有的反射率，是地表+气溶胶+各种分子。</p><p>所以想计算瑞利反射，我们需要取消掉其他所有的计算，这意味着我们得到的反射率只包含瑞利反射。</p><p>代码是这样的</p><div class=code-block-wrapper><button aria-label="Copy code" class=code-copy-button type=button></button><pre class="astro-code astro-code-themes github-dark github-light" data-copy-button-added=true data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>from</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Py6S </span><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> SixS()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Standard altitude settings for the sensor</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># and target</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.altitudes.set_sensor_satellite_level()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.altitudes.set_target_sea_level()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># Wavelength of 0.5nm</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.wavelength </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Wavelength(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># turn off the ground reflectance</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.ground_reflectance </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> GroundReflectance.HomogeneousLambertian(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># turn off the aerosol scattering</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.aero_profile </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> AeroProfile.PredefinedType(AeroProfile.NoAerosols)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># turn off the atmospheric absorption by gases</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.atmos_profile </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> AtmosProfile.PredefinedType(AtmosProfile.NoGaseousAbsorption)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># then run the simulation and look the output</span></span>
<span class=line></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(s.outputs.fulltext)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>Rc</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> s.outputs.apparent_reflectance</span></span></code></pre></div><p>这样，虽然最后计算出来的东西叫apparent reflectance，但是因为我们把瑞利反射外所有的反射都去掉了，所以这个apparent reflectance就是最终的Rayleigh reflectance。</p><p>除此之外，还有一些有意思的东西。</p><p>第一，我们其实不需要把地面的反射率设为0，如果我们把地面反射率设为其他的东西，比如</p><div class=code-block-wrapper><button aria-label="Copy code" class=code-copy-button type=button></button><pre class="astro-code astro-code-themes github-dark github-light" data-copy-button-added=true data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.ground_reflectance </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> GroundReflectance.HomogeneousLambertian(GroundReflectance.GreenVegetation)</span></span></code></pre></div><p>将会得到一些不一样的数值，这个数值叫做atmospheric intrinsic reflectance，这是直接来自大气的反射率（在本例中只是来自瑞利散射，但在正常情况下，这也包括气溶胶散射）。这可以作为s.output.urgeric_intrinsic_reflectance进行访问。</p><p>还有一件事，只是为了表明Py6S中的瑞利反射率的行为方式与我们所了解的物理学知识相一致…我们可以编写一点代码，提取不同波长的瑞利反射率并绘制成图—我们希望有一条指数递减的曲线，显示低波长的高瑞利反射率，反之亦然。</p><div class=code-block-wrapper><button aria-label="Copy code" class=code-copy-button type=button></button><pre class="astro-code astro-code-themes github-dark github-light" data-copy-button-added=true data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>from</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Py6S </span><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pandas </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pd</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> matplotlib.pyplot </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> plt</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>%</span><span style=color:#24292e;--shiki-dark:#E1E4E8>matplotlib inline</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> SixS()</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.altitudes.set_sensor_satellite_level()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.altitudes.set_target_sea_level()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.aero_profile </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> AeroProfile.PredefinedType(AeroProfile.NoAerosols)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>s.atmos_profile </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> AtmosProfile.PredefinedType(AtmosProfile.NoGaseousAbsorption)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>wavelengths </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.arange(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1.0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.05</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>results </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> []</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> wv </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> wavelengths:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    s.wavelength </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> Wavelength(wv)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    s.run()</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    results.append({</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'wavelength'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>: wv,</span></span>
<span class=line><span style=color:#032f62;--shiki-dark:#9ECBFF>                   'rayleigh_refl'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>: s.outputs.atmospheric_intrinsic_reflectance})</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>results </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pd.DataFrame(results)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>results.plot(</span><span style=color:#e36209;--shiki-dark:#FFAB70>x</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'wavelength'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>y</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'rayleigh_refl'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>style</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'x-'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>label</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Rayleigh Reflectance'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>grid</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.xlabel(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Wavelength ($\mu m$)'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.ylabel(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Rayleigh Reflectance (no units)'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span></code></pre></div><p>这个图是</p><figure><img alt=file src=https://blog.rtwilson.com/wp-content/uploads/2019/09/image-1569879583877.png><figcaption>file</figcaption></figure><p>在这一大块代码中没有什么特别革命性的东西—我们只是结合了我之前演示的代码，然后在各种波长中循环，为每个波长运行模型。</p><p>我们存储模型结果的方式值得简单解释一下，因为这是我经常使用的一种模式。每次运行模型，都会有一个新的dict被添加到一个列表中—这个dict有我们感兴趣的各种参数（在这里只是波长）和我们感兴趣的各种结果（在这里只是Rayleigh反射率）的条目。循环结束后，我们可以简单地将这个dict列表传递给pd.DataFrame()，然后得到一个漂亮的pandas DataFrame - 准备好显示、绘制或进一步分析。</p><p>其他的一些设置</p><p>瑞利反射率将根据视角和太阳角的不同而变化。你可以通过s.geometry = Geometry.User()手动设置，然后设置s.geometry.solar_z, solar_a等。或者你可以通过使用Geometry.User.from_time_and_location()来半自动地设置，它将根据位置和时间自动设置太阳角，并允许你手动设置视图角度。</p><p>至于大气压力等等，它实际上是作为设置海拔高度的一部分而配置的。你可以在高度方面设置高度，也可以在压力方面设置高度—见<a href=https://py6s.readthedocs.io/en/latest/params.html#Py6S.Altitudes.set_target_pressure%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%9C%89%E4%BB%BB%E4%BD%95%E8%BF%9B%E4%B8%80%E6%AD%A5%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E8%AF%B7%E9%9A%8F%E6%97%B6%E8%AF%A2%E9%97%AE%E3%80%82 rel="nofollow noopener noreferrer external" target=_blank>https://py6s.readthedocs.io/en/latest/params.html#Py6S.Altitudes.set_target_pressure，如果你有任何进一步的问题，请随时询问。</a></p><div id=post-copyright></div><div class="mt-12.6 uno-decorative-line"></div><div class="flex flex-wrap gap-x-3 gap-y-3.2 no-heti"><a href=/tags/大气校正/ class="hover:c-primary border border-secondary/25 ease-out hover:border-secondary/80 hover:font-medium hover:ring-0.2 inline-block px-3.2 py-0.7 relative ring-0 ring-secondary/80 rounded-full transition-[colors,box-shadow]"><span class="flex absolute inset-0 items-center justify-center transition-font-weight whitespace-nowrap">大气校正 </span><span class="inline-block font-medium opacity-0" aria-hidden=true>大气校正 </span></a><a href="/tags/Remote Sensing/" class="hover:c-primary border border-secondary/25 ease-out hover:border-secondary/80 hover:font-medium hover:ring-0.2 inline-block px-3.2 py-0.7 relative ring-0 ring-secondary/80 rounded-full transition-[colors,box-shadow]"><span class="flex absolute inset-0 items-center justify-center transition-font-weight whitespace-nowrap">Remote Sensing </span><span class="inline-block font-medium opacity-0" aria-hidden=true>Remote Sensing</span></a></div></div></article></main><footer class="font-navbar leading-1.25em lg:text-3.5 text-3" lg="uno-desktop-column bottom-20"><p><a href=/atom.xml/ class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>RSS</a>&nbsp;/ <a href=https://github.com/lifeodyssey class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>GitHub</a>&nbsp;/ <a href=mailto:email@radishzz.cc class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Email</a>&nbsp;</p><p>© 2025-2026 周大侠</p><p>Powered by <a href=https://astro.build/ class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Astro</a> and <a href=https://github.com/radishzzz/astro-theme-retypeset class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Retypeset</a></p></footer></div><div class="flex absolute gap-6 lg:bottom-[min(10.27rem+1.92vw,12rem)] lg:fixed lg:right-[max(5rem,calc(50vw-35rem))] lg:top-auto lg:w-14rem min-[823px]:max-lg:right-[calc(50vw-22rem)] right-7.25vw top-14.6"><a href=/posts/514b9dac.html.html/ class="hover:c-primary active:scale-90 aspect-square c-secondary w-4" aria-label="Switch website language" id=language-switcher><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M19.18 21.1 12.4 1.89h-1.21L4.52 21.1l-2.53.2v.81h6.37v-.81l-2.83-.2 2.02-5.97h7.58l2.02 5.97-3.34.2v.81H22v-.81l-2.83-.2zM7.85 14.33l3.44-10.21 3.54 10.21z"/></svg> </a><button aria-label="Switch light/dark theme" class="hover:c-primary active:scale-90 aspect-square c-secondary w-4" id=theme-toggle-button><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M12.06.61C5.66.61.46 5.71.46 12.11s5.1 11.5 11.6 11.5 11.5-5.1 11.5-11.5S18.46.61 12.06.61m0 21c-6.07 0-10.94-4.2-10.94-9.5s4.87-9.4 10.94-9.4S23 6.91 23 12.21s-4.88 9.4-10.94 9.4"/></svg></button></div><script>!function(){const e="oklch(96% 0.005 298)",t="oklch(22% 0.005 298)";function n(n){document.documentElement.classList.toggle("dark",n);const o=document.head.querySelector('meta[name="theme-color"]');o&&e&&t&&o.setAttribute("content",n?t:e),localStorage.setItem("theme",n?"dark":"light"),document.dispatchEvent(new Event("theme-changed"))}function o(){n(!document.documentElement.classList.contains("dark"))}document.addEventListener("click",(function(e){const t=e.target instanceof Element?e.target:null,n=t?.closest("#theme-toggle-button");if(!n)return;if(document.documentElement.classList.contains("reduce-motion"))return void o();document.documentElement.style.setProperty("view-transition-name","animation-theme-toggle"),document.documentElement.setAttribute("data-theme-changing",""),document.startViewTransition(o).finished.then((()=>{document.documentElement.style.removeProperty("view-transition-name"),document.documentElement.removeAttribute("data-theme-changing")}))}),{passive:!0}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{n(e.matches)}))}()</script><script type=module>const o={click:"tap",typing:"type"},l={[o.click]:.8,[o.typing]:.4},d=["#language-switcher","#theme-toggle-button"],f=[".el-input__inner",".el-textarea__inner","#wl-nick","#wl-mail","#wl-link","#wl-edit"],h=new Set(["Shift","Control","Alt","Meta","Tab","Escape","CapsLock"]),p=d.join(","),g=f.join(",");function r(){return window.matchMedia("(max-width: 1023px)").matches}function w(){return document.head.querySelector('link[rel="sitemap"]')?.getAttribute("href")?.replace("/sitemap-index.xml","")||""}class y{audioContext=null;audioBuffers={[o.click]:[],[o.typing]:[]};initPromise=null;async fetchAndCacheSound(t,e){if(!this.audioContext)throw new Error("Audio context not initialized");const n=`${t}_0${e+1}`,i=await(await fetch(`${w()}/sounds/${n}.wav`)).arrayBuffer(),a=await this.audioContext.decodeAudioData(i);this.audioBuffers[t].push(a)}async preloadAllSounds(){const t=Object.values(o).flatMap((t=>Array.from({length:5},((e,n)=>this.fetchAndCacheSound(t,n)))));await Promise.allSettled(t)}async initialize(){return this.initPromise??=(async()=>{const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,await this.preloadAllSounds()})()}async playSound(t){try{if(await this.initialize(),!this.audioContext)return;"suspended"===this.audioContext.state&&await this.audioContext.resume();const e=this.audioBuffers[t];if(0===e.length)return;const n=this.audioContext.createBufferSource();n.buffer=e[Math.floor(Math.random()*e.length)];const i=this.audioContext.createGain();i.gain.value=l[t],n.connect(i).connect(this.audioContext.destination),n.start(0)}catch(t){console.warn("Sound playback failed:",t)}}}const c=new y;function m(t){r()||!t.target?.closest(p)||c.playSound(o.click)}function x(t){r()||t.ctrlKey||t.altKey||t.metaKey||h.has(t.key)||!t.target?.closest(g)||c.playSound(o.typing)}document.addEventListener("click",m,{passive:!0}),document.addEventListener("keydown",x,{passive:!0})</script><script type=module>const s={copy:'<svg\n      viewBox="0 0 24 24"\n      fill="currentColor"\n    >\n      <path d="M6.9.8v18h14.5V.8zm12.8 16h-11v-14h11z"/>\n      <path d="M4.3 21.2V5.6l-1.7.5v17.1h14.3l.6-2z"/>\n    </svg>',success:'<svg\n      viewBox="0 0 24 24"\n      fill="currentColor"\n    >\n      <path d="m23.1 6.4-1.3-1.3L9.4 16.6l-6.3-5.4-1.2 1.2L9.4 20z"/>\n    </svg>'},o=new WeakMap;function r(){const e=document.querySelectorAll(".code-copy-button");0!==e.length&&e.forEach((e=>{e.innerHTML=s.copy}))}async function a(e){if(e.classList.contains("copy-success"))return;const t=e.parentElement?.querySelector("pre code"),n=t?.textContent??"";if(t&&n)try{await navigator.clipboard.writeText(n);const t=o.get(e);t&&clearTimeout(t),e.innerHTML=s.success,e.classList.add("copy-success");const c=setTimeout((()=>{e.isConnected&&(e.innerHTML=s.copy,e.classList.remove("copy-success"),o.delete(e))}),1500);o.set(e,c)}catch(e){console.error("Failed to copy code",e)}}function l(e){const t=e.target instanceof Element&&e.target.closest(".code-copy-button");t&&a(t)}document.addEventListener("astro:page-load",r),document.addEventListener("click",l,{passive:!0}),r()</script><script type=module>async function p(t){const e=t.dataset.repo;if(!e)return;const o=t.getElementsByClassName("gc-owner-avatar")[0],n=t.getElementsByClassName("gc-repo-description")[0],s=t.getElementsByClassName("gc-stars-count")[0],a=t.getElementsByClassName("gc-forks-count")[0],r=t.getElementsByClassName("gc-license-info")[0];function c(t){const e=new Intl.NumberFormat("en",{notation:"compact",maximumFractionDigits:1});o&&t.owner?.avatar_url&&(o.style.backgroundImage=`url(${t.owner.avatar_url})`),n&&(n.textContent=t.description??"No description"),s&&(s.textContent=e.format(t.stargazers_count??0)),a&&(a.textContent=e.format(t.forks_count??0)),r&&(r.textContent=t.license?.spdx_id??"No License")}const i=`github-repo-${e}`,m=sessionStorage.getItem(i);if(m){c(JSON.parse(m))}else try{const t=await fetch(`https://api.github.com/repos/${e}`);if(!t.ok){if(n){const e=404===t.status?"Repository not found":"Failed to load repository data";n.textContent=e}return}const o=await t.json();sessionStorage.setItem(i,JSON.stringify(o)),c(o)}catch(t){console.error(`Failed to fetch ${e}:`,t)}}function f(){const t=document.getElementsByClassName("gc-container");0!==t.length&&Array.from(t).forEach((t=>{p(t)}))}document.addEventListener("astro:page-load",f),f()</script><script type=module src=/_astro/MediaEmbed.astro_astro_type_script_index_0_lang.wKrCMCCr.js></script><script type=module>const n={overlay:document.querySelector(".zoom-overlay"),zoomedImg:null,originalImg:null,createOverlay(){this.overlay&&this.overlay.isConnected||(this.overlay=document.createElement("div"),this.overlay.classList.add("zoom-overlay"),this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-label","Image Viewer"),this.overlay.setAttribute("tabindex","-1"),Object.assign(this.overlay.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"999",backgroundColor:"oklch(var(--un-preset-theme-colors-background) / 0.95)",opacity:"0",transition:"opacity 300ms cubic-bezier(0.4, 0, 0.2, 1)",cursor:"zoom-out",display:"none"}),document.body.appendChild(this.overlay))},zoomImg(e){if(!this.overlay)return;document.body.style.overflow="hidden";const t=e.getBoundingClientRect();this.originalImg=e,this.zoomedImg=e.cloneNode(),Object.assign(this.zoomedImg.style,{position:"fixed",top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1)",zIndex:"1000",cursor:"zoom-out"}),document.body.appendChild(this.zoomedImg),this.overlay.style.display="block",this.overlay.focus();const o=window.innerWidth,i=window.innerHeight,s=window.innerWidth<768?1:.8,l=Math.min(o*s/t.width,i*s/t.height),a=(-t.left+(o-t.width)/2)/l,n=(-t.top+(i-t.height)/2)/l;requestAnimationFrame((()=>{this.overlay&&(this.overlay.style.opacity="1"),this.zoomedImg&&(this.zoomedImg.style.transform=`scale(${l}) translate3d(${a}px, ${n}px, 0)`)}))},close(){!this.overlay||!this.zoomedImg||!this.originalImg||(this.zoomedImg.style.transform="",this.overlay.style.opacity="0",document.body.style.overflow="",setTimeout((()=>{this.zoomedImg&&this.zoomedImg.parentNode&&document.body.removeChild(this.zoomedImg),this.zoomedImg=null,this.overlay&&(this.overlay.style.display="none"),this.originalImg&&this.originalImg.focus(),this.originalImg=null}),300))},setupOverlay(){this.createOverlay(),this.zoomedImg=null,this.originalImg=null},handleClick(e){if(this.zoomedImg)return void this.close();const t=e.target;t instanceof HTMLImageElement&&t.complete&&t.naturalWidth>=100&&t.naturalHeight>=100&&this.zoomImg(t)},handleResize(){this.zoomedImg&&this.close()},init(){this.createOverlay(),document.addEventListener("astro:page-load",(()=>this.setupOverlay())),document.addEventListener("click",(e=>this.handleClick(e)),{passive:!0}),window.addEventListener("resize",(()=>this.handleResize()),{passive:!0})}};n.init()</script></body></html>