<!DOCTYPE html><html class="font-sans scroll-smooth" lang=zh-CN><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><link href=/icons/favicon.svg rel=icon type=image/svg+xml><title>没有大气校正和实测数据怎么搞水色 | 乔克叔叔的床边故事</title><meta content=看到标题是不是觉得很奇怪，没错，我也觉得很奇怪，但没办法，这是客户的要求。国产卫星两大麻烦的地方，一个是没有准确的辐射校正与大气校正，然后还不公开完整的数据与标准处理方式，这样的话我们想搞准确的辐射校正和大气校正，或者说需要某个波段处理到某... name=description><meta content=周大侠 name=author><meta content="Astro v5.13.7" name=generator><meta content="oklch(96% 0.005 298)" name=theme-color><link href=/fonts/EarlySummer-VF-Split/EarlySummer-VF-Subset.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Snell-Black-SF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/Snell-Bold-SF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/STIX-VF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/fonts/STIX-Italic-VF.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=/_astro/katex.min.COXD5gRV.css rel=stylesheet media=print onload="this.media=&#34;all&#34;"><link href=https://lifeodyssey.github.io/posts/6c4d8823.html.html rel=canonical><link href=/sitemap-index.xml rel=sitemap><link href=/rss.xml rel=alternate type=application/rss+xml title="RSS Feed"><link href=/atom.xml rel=alternate type=application/atom+xml title="Atom Feed"><link href=https://lifeodyssey.github.io rel=alternate hreflang=zh><link href=https://lifeodyssey.github.io/en/ rel=alternate hreflang=en><link href=https://lifeodyssey.github.io/ja/ rel=alternate hreflang=ja><meta content=article property=og:type><meta content=https://lifeodyssey.github.io/posts/6c4d8823.html.html property=og:url><meta content="没有大气校正和实测数据怎么搞水色 | 乔克叔叔的床边故事" property=og:title><meta content=看到标题是不是觉得很奇怪，没错，我也觉得很奇怪，但没办法，这是客户的要求。国产卫星两大麻烦的地方，一个是没有准确的辐射校正与大气校正，然后还不公开完整的数据与标准处理方式，这样的话我们想搞准确的辐射校正和大气校正，或者说需要某个波段处理到某... property=og:description><meta content=https://lifeodyssey.github.io/og/6c4d8823.png property=og:image><meta content=summary_large_image name=twitter:card><meta content=true name=astro-view-transitions-enabled><meta content=none name=astro-view-transitions-fallback><script type=module src=/_astro/ClientRouter.astro_astro_type_script_index_0_lang.1k2cUud7.js></script><script>!function(){function e(e=document){const t=function(){const e=localStorage.getItem("theme");return!!e&&"dark"===e}();e.documentElement.classList.toggle("dark",t);const n=e.head.querySelector('meta[name="theme-color"]');n&&n.setAttribute("content",t?"oklch(22% 0.005 298)":"oklch(96% 0.005 298)")}function t(e=document){const t=window.matchMedia("(prefers-reduced-motion: reduce)").matches||!("startViewTransition"in e);e.documentElement.classList.toggle("reduce-motion",t)}document.addEventListener("astro:before-swap",(({newDocument:n})=>{e(n),t(n)})),e(),t()}()</script><link href=/_astro/_about_.Dzb1Me_E.css rel=stylesheet><link href=/_astro/_posts_slug_.CM85RmC-.css rel=stylesheet><script type=module src=/_astro/page.BNYwb576.js></script><script>!function(t,e,n,r){(window.crossOriginIsolated||navigator.serviceWorker)&&((r=t[e]=Object.assign(t[e]||{},{lib:"/~partytown/",debug:!1}))[n]=(r[n]||[]).concat(["dataLayer.push","gtag"]))}(window,"partytown","forward");const tp={preserveBehavior:!1},ep=t=>{if("string"==typeof t)return[t,tp];const[e,n=tp]=t;return[e,{...tp,...n}]},n=Object.freeze((()=>{const t=new Set;let e=[];do{Object.getOwnPropertyNames(e).forEach((n=>{"function"==typeof e[n]&&t.add(n)}))}while((e=Object.getPrototypeOf(e))!==Object.prototype);return Array.from(t)})());!function(t,e,r,o,i,a,s,c,d,p,l=t,u){function f(){u||(u=1,"/"==(s=(a.lib||"/~partytown/")+(a.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),o!=t?o.dispatchEvent(new CustomEvent("pt1",{detail:t})):(c=setTimeout(w,(null==a?void 0:a.fallbackTimeout)||1e4),e.addEventListener("pt0",h),i?y(1):r.serviceWorker?r.serviceWorker.register(s+(a.swPath||"partytown-sw.js"),{scope:s}).then((function(t){t.active?y():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&y()}))}),console.error):w())))}function y(n){p=e.createElement(n?"script":"iframe"),t._pttab=Date.now(),n||(p.style.display="block",p.style.width="0",p.style.height="0",p.style.border="0",p.style.visibility="hidden",p.setAttribute("aria-hidden",!0)),p.src=s+"partytown-"+(n?"atomics.js?v=0.11.1":"sandbox-sw.html?"+t._pttab),e.querySelector(a.sandboxParent||"body").appendChild(p)}function w(n,r){for(h(),o==t&&(a.forward||[]).map((function(e){const[n]=ep(e);delete t[n.split(".")[0]]})),n=0;n<d.length;n++)(r=e.createElement("script")).innerHTML=d[n].innerHTML,r.nonce=a.nonce,e.head.appendChild(r);p&&p.parentNode.removeChild(p)}function h(){clearTimeout(c)}a=t.partytown||{},o==t&&(a.forward||[]).map((function(e){const[r,{preserveBehavior:o}]=ep(e);l=t,r.split(".").map((function(e,r,i){var a;l=l[i[r]]=r+1<i.length?l[i[r]]||(a=i[r+1],n.includes(a)?[]:{}):(()=>{let e=null;if(o){const{methodOrProperty:n,thisObject:r}=((t,e)=>{let n=t;for(let t=0;t<e.length-1;t+=1)n=n[e[t]];return{thisObject:n,methodOrProperty:e.length>0?n[e[e.length-1]]:void 0}})(t,i);"function"==typeof n&&(e=(...t)=>n.apply(r,...t))}return function(){let n;return e&&(n=e(arguments)),(t._ptf=t._ptf||[]).push(i,arguments),n}})()}))})),"complete"==e.readyState?f():(t.addEventListener("DOMContentLoaded",f),t.addEventListener("load",f))}(window,document,navigator,top,window.crossOriginIsolated),document.addEventListener("astro:before-swap",(t=>{let e=document.body.querySelector("iframe[src*='/~partytown/']");e&&t.newDocument.body.append(e)}))</script><style>[data-astro-transition-scope=astro-va26yt7w-1]{view-transition-name:post-6c4d8823-zh}@layer astro{::view-transition-old(post-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(post-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(post-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(post-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-va26yt7w-1],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-va26yt7w-1]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-aqc54ihn-2]{view-transition-name:time-6c4d8823-zh}@layer astro{::view-transition-old(time-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(time-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(time-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(time-6c4d8823-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-aqc54ihn-2],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-aqc54ihn-2]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style><style>[data-astro-transition-scope=astro-wif6pdce-3]{view-transition-name:site-title-zh}@layer astro{::view-transition-old(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}::view-transition-new(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back]::view-transition-old(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back]::view-transition-new(site-title-zh){animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}}[data-astro-transition-fallback=old] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition-fallback=old][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition-fallback=new] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition-fallback=new][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}[data-astro-transition=back][data-astro-transition-fallback=old] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition=back][data-astro-transition-fallback=old][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeOut}[data-astro-transition=back][data-astro-transition-fallback=new] [data-astro-transition-scope=astro-wif6pdce-3],[data-astro-transition=back][data-astro-transition-fallback=new][data-astro-transition-scope=astro-wif6pdce-3]{animation-duration:180ms;animation-timing-function:cubic-bezier(0.76,0,0.24,1);animation-fill-mode:both;animation-name:astroFadeIn}</style></head><body><div class="max-w-205.848 min-h-dvh min-h-vh mx-auto w-full" lg="mx-[max(5.75rem,calc(50vw-34.25rem))] my-20 max-w-[min(calc(75vw-16rem),44rem)] min-h-full p-0" p="x-[min(7.25vw,3.731rem)] y-10"><header class="cjk:tracking-0.02em lg:uno-desktop-column lg:top-20 mb-10.8"><h2 class="c-secondary font-bold font-title lg:c-primary lg:mb-1.8 lg:mt-0 lg:text-9 mb-2.8 mt-3 text-5.375"><div class="inline-block box-content pr-1" data-astro-transition-scope=astro-wif6pdce-3 data-disable-theme-transition><a href=/ id=site-title-link>乔克叔叔的床边故事</a></div></h2></header><nav aria-label="Site Navigation" class="cjk:tracking-0.02em lg:uno-desktop-column font-navbar font-semibold hidden leading-2.45em lg:block lg:bottom-[min(9.04rem+3.85vw,12.5rem)] lg:text-4 mb-10.5 text-3.6"><ul><li><a href=/ class="after:bottom-0.7em c-primary font-bold highlight-static">文章</a></li><li><a href=/tags/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">标签</a></li><li><a href=/about/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">关于</a></li><li><a href=/search/ class="hover:c-primary highlight-hover after:bottom-0.7em hover:font-bold transition-[colors,font-weight]">Search</a></li></ul></nav><main class=mb-10><article class=heti><div class=relative><button aria-label="Go back" class=hidden id=back-button lg="absolute left--10 top-3.8 block aspect-square w-4.5 c-secondary/40 transition-colors ease-out hover:c-secondary/80 active:scale-90!"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d=M17.8.7L4,12l13.8,11.4.7-.9L7.2,12,18.5,1.5l-.7-.8Z /></svg></button><script type=module>function e(t){if(!(t.target instanceof Element?t.target:null)?.closest("#back-button"))return;if(window.history.length>1)return void window.history.back();const e=document.getElementById("site-title-link");e&&e.click()}document.addEventListener("click",e,{passive:!0})</script><h1 class=post-title><span data-astro-transition-scope=astro-va26yt7w-1 data-disable-theme-transition>没有大气校正和实测数据怎么搞水色</span></h1></div><div class="c-primary block font-time mb-17.2" data-astro-transition-scope=astro-aqc54ihn-2 data-disable-theme-transition id=post-date><time datetime=2022-06-14>2022-06-14 </time><span class=ml-1.75>8 min</span></div><script type=module>let s=null,i=null;function g(){if(!(window.innerWidth>=1536))return;const t=document.getElementById("toc-accordion-content");if(!t)return;const e=t.getElementsByTagName("a");if(0===e.length)return;const n=Array.from(e,(t=>t)),o=n.some((t=>t.classList.contains("toc-links-h2")))?"toc-links-h2":"toc-links-h3",c=new Map;n.forEach((t=>{const e=t.getAttribute("href")?.substring(1);e&&c.set(e,t)}));let r=null;function l(t){t!==r&&(n.forEach((t=>{t.classList.remove("toc-link-active")})),t.classList.add("toc-link-active"),t.classList.contains(o)||function(t){for(let e=n.indexOf(t)-1;e>=0;e--){const t=n[e];if(t.classList.contains(o)){t.classList.add("toc-link-active");break}}}(t),r=t,t.scrollIntoView({behavior:"smooth",block:"nearest"}))}s=new IntersectionObserver((t=>{const e=t.find((t=>t.isIntersecting))?.target?.id;if(e){const t=c.get(e);t&&l(t)}}),{rootMargin:"0% 0% -66% 0%",threshold:[.4]}),Array.from(document.querySelectorAll("h2, h3, h4")).filter((t=>t.id&&"footnotes"!==t.id)).forEach((t=>s?.observe(t)));const a=document.getElementById("post-copyright");a&&(i=new IntersectionObserver((t=>{!t[0].isIntersecting&&t[0].boundingClientRect.top<0&&(n.forEach((t=>t.classList.remove("toc-link-active"))),r=null)}),{rootMargin:"0px 0px 0px 0px",threshold:0}),i?.observe(a),n.length>0&&l(n[0]))}function m(){s?.disconnect(),i?.disconnect(),s=null,i=null}document.addEventListener("astro:after-swap",g),document.addEventListener("astro:before-swap",m),g()</script><div id=post-content><p>看到标题是不是觉得很奇怪，没错，我也觉得很奇怪，但没办法，这是客户的要求。</p><h1 id=开局吐槽>开局吐槽<a href=#开局吐槽 class=heading-anchor-link aria-label="Link to 开局吐槽"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M2.6 21.4c2 2 5.9 2.9 8.9 0l3.5-3.5-1-1-3.5 3.5c-1.4 1.4-4.2 1.9-6.4-.3s-1.8-5-.3-6.4l3.5-3.5-1-1-3.5 3.5c-3 3-2 6.9 0 8.9ZM21.4 2.6c2 2 2.9 5.9 0 8.9L17.9 15l-1-1 3.5-3.5c1.4-1.4 1.9-4.2-.3-6.4s-5-1.8-6.4-.3l-3.5 3.5-1-1 3.5-3.5c3-3 6.9-2 8.9 0Z"></path><path d="m8.01 14.97 6.93-6.93 1.061 1.06-6.93 6.93z"></path></svg></a></h1><p>国产卫星两大麻烦的地方，一个是没有准确的辐射校正与大气校正，然后还不公开完整的数据与标准处理方式，这样的话我们想搞准确的辐射校正和大气校正，或者说需要某个波段处理到某一个级别的未公开的数据，就只能自己从头开始搞，并且想参考标准的处理流程的时候，人家不给你代码，问就是保密要求，咱也不知道国内哪来那么多保密级别；另一个是没有公开详细的ATBD (Algorithm Theoretical Basis Document)(<strong>首先是公开都不公开</strong>，我们想知道标准产品怎么算的只能靠猜，详细的定义可以看看MODIS的ATBD，可以直接当教科书用)，别的国家啥情况我不知道，日本和韩国在卫星数据还没公开的时候就把最初版本的ATBD放出来了，并且在获取了足够的卫星数据之后很快就发布标准产品的实地检验结果，国产那俩水色卫星发射这么久，国家海洋卫星应用中心的官网连个P都不放一个。</p><p>当然还有一个麻烦的地方就是下载麻烦，批量下载还需要写机构申请或者拿U盘，真的2202年了，世界第二大国能不能有点世界大国的心胸，官网没有英语页面也就罢了，下载的方法能不能和国际接轨一下。日本水色人才都空心了，SGLI卫星的各个指标都搞得比国内好的不知道哪里去了，我们交了这么多税你们就搁着干这个呢？</p><h1 id=客户要求>客户要求<a href=#客户要求 class=heading-anchor-link aria-label="Link to 客户要求"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M2.6 21.4c2 2 5.9 2.9 8.9 0l3.5-3.5-1-1-3.5 3.5c-1.4 1.4-4.2 1.9-6.4-.3s-1.8-5-.3-6.4l3.5-3.5-1-1-3.5 3.5c-3 3-2 6.9 0 8.9ZM21.4 2.6c2 2 2.9 5.9 0 8.9L17.9 15l-1-1 3.5-3.5c1.4-1.4 1.9-4.2-.3-6.4s-5-1.8-6.4-.3l-3.5 3.5-1-1 3.5-3.5c3-3 6.9-2 8.9 0Z"></path><path d="m8.01 14.97 6.93-6.93 1.061 1.06-6.93 6.93z"></path></svg></a></h1><p>客户给我的是一个新发射的国产的高光谱卫星，可见光及红外波段有76个波段，SWIR有90个波段，分辨率没细看估计挺高的，为了给客户保密，我就不放结果的图了。问题在下面几个。</p><ul><li>没有Spectral Response Function</li><li>没有 extraterrestrial solar irradiance</li><li>辐射定标只定标到Radiance</li><li>只有一景的卫星图片</li></ul><p>可能是因为刚发射没多久 所以这些该有的都没有吧</p><p>稍微学过一点水色的都知道，前两个是做大气校正或者大气部分校正的必要条件，只要有前两个，就可以拿py6s做瑞利校正。但是这连前两个都没有，摊手。</p><p>而最后一个又限制了神经网络的使用(当然我也懒得给他匹配那么多数据做神经网络)，那还能咋办呢？</p><h1 id=解决思路>解决思路<a href=#解决思路 class=heading-anchor-link aria-label="Link to 解决思路"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M2.6 21.4c2 2 5.9 2.9 8.9 0l3.5-3.5-1-1-3.5 3.5c-1.4 1.4-4.2 1.9-6.4-.3s-1.8-5-.3-6.4l3.5-3.5-1-1-3.5 3.5c-3 3-2 6.9 0 8.9ZM21.4 2.6c2 2 2.9 5.9 0 8.9L17.9 15l-1-1 3.5-3.5c1.4-1.4 1.9-4.2-.3-6.4s-5-1.8-6.4-.3l-3.5 3.5-1-1 3.5-3.5c3-3 6.9-2 8.9 0Z"></path><path d="m8.01 14.97 6.93-6.93 1.061 1.06-6.93 6.93z"></path></svg></a></h1><p>那就直接上统计的办法吧。</p><p>我在处理高光谱卫星的时候的一个强烈体会是，高光谱卫星需要的计算资源比我想象的要多的多，我16g内存如果不对高光谱数据做任何降维和并行处理的话，在我自己的电脑上是完全跑不了的, kernel always die，那就，就这这个下台阶。大概的思路如下。</p><ol><li>对VNIR波段数据做PCA降维</li><li>对降维后的数据做K-means cluster，提取水体mask</li><li>将PCs mask之后 upscale到OLCI的分辨率，跑个简单的线性回归找个R2最高的</li><li>把线性回归用在upscale之前的数据上</li></ol><p>客户给的钱也不多 不然我就把线性回归换成RF+error downscale了</p><h1 id=部分参考代码>部分参考代码<a href=#部分参考代码 class=heading-anchor-link aria-label="Link to 部分参考代码"><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M2.6 21.4c2 2 5.9 2.9 8.9 0l3.5-3.5-1-1-3.5 3.5c-1.4 1.4-4.2 1.9-6.4-.3s-1.8-5-.3-6.4l3.5-3.5-1-1-3.5 3.5c-3 3-2 6.9 0 8.9ZM21.4 2.6c2 2 2.9 5.9 0 8.9L17.9 15l-1-1 3.5-3.5c1.4-1.4 1.9-4.2-.3-6.4s-5-1.8-6.4-.3l-3.5 3.5-1-1 3.5-3.5c3-3 6.9-2 8.9 0Z"></path><path d="m8.01 14.97 6.93-6.93 1.061 1.06-6.93 6.93z"></path></svg></a></h1><p>高光谱卫星预处理</p><div class=code-block-wrapper><button aria-label="Copy code" class=code-copy-button type=button></button><pre class="astro-code astro-code-themes github-dark github-light" data-copy-button-added=true data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # Read File</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> os</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> glob</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>from</span><span style=color:#24292e;--shiki-dark:#E1E4E8> os.path </span><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> isfile, join</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>folderpath</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>''</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> path, subdirs, files </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> os.walk(folderpath):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> name </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> files:</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>        print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(os.path.join(path, name))</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#import xarray as xr</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>from</span><span style=color:#24292e;--shiki-dark:#E1E4E8> osgeo </span><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> gdal</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>gdal.UseExceptions()</span></span>
<span class=line></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>gdal.Open(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'/ZY1F_AHSI_.tif'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>             gdal.</span><span style=color:#005cc5;--shiki-dark:#79B8FF>GA_ReadOnly</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>VNband1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>VNim1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>VNband1.ReadAsArray()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pandas </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pd</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> matplotlib.pyplot </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> plt</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(VNim1)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterCount</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterXSize</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterYSize</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>gdal.Open(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'ZY1F_AHSI.tif'</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>            ,gdal.</span><span style=color:#005cc5;--shiki-dark:#79B8FF>GA_ReadOnly</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>SWband1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>90</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>SWim1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>SWband1.ReadAsArray()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(SWim1)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterCount</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterXSize</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.RasterYSize</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>OGP</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>gdal.Open(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'OGP.tif'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>             gdal.</span><span style=color:#005cc5;--shiki-dark:#79B8FF>GA_ReadOnly</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPband1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>OGP</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPim1</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPband1.ReadAsArray()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(OGPim1)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPband2</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>OGP</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPim2</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>OGPband2.ReadAsArray()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(OGPim2)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> geopandas </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> gpd</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>shapefile </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> gpd.read_file(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"ZY1F_AHSI.shp"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>shapefile.keys()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(shapefile)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>shapefile[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'geometry'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # RadCal</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#GAIN from .raw file open with txt editor</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>VNGain</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(VNGain)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>SWGain</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[ ]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(SWGain)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>VNarr</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ones((</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2051</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>76</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>76</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    VNarr[:,:,i]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>VN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(i</span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>).ReadAsArray()</span><span style=color:#d73a49;--shiki-dark:#F97583>*</span><span style=color:#24292e;--shiki-dark:#E1E4E8>VNGain[i]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>SWarr</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ones((</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2051</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>90</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>90</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    SWarr[:,:,i]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>SW</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.GetRasterBand(i</span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>).ReadAsArray()</span><span style=color:#d73a49;--shiki-dark:#F97583>*</span><span style=color:#24292e;--shiki-dark:#E1E4E8>SWGain[i]</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(VNarr[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(VNarr[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>75</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # PCA</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spectral </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spy</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>pc </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spy.principal_components(VNarr)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>pc_99 </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pc.reduce(</span><span style=color:#e36209;--shiki-dark:#FFAB70>fraction</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.999</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)  </span><span style=color:#6a737d;--shiki-dark:#6A737D># 保留99.9%的特征值</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>spy.imshow(pc.cov)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>pc.eigenvalues</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>pc_99.mean</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(pc_99.eigenvalues))  </span><span style=color:#6a737d;--shiki-dark:#6A737D># 剩下的特征值数量</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>img_pc </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pc_99.transform(VNarr)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>v </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spy.imshow(img_pc[:,:,:</span><span style=color:#005cc5;--shiki-dark:#79B8FF>3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>], </span><span style=color:#e36209;--shiki-dark:#FFAB70>stretch_all</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(img_pc[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(img_pc[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(img_pc[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # water mask</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>(m,c)</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>spy.kmeans(img_pc,</span><span style=color:#e36209;--shiki-dark:#FFAB70>nclusters</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(m)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>Mask</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ma.masked_less(m,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(Mask)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>Mask</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.save(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"VNarrData.npy"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,VNarr)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>VNarr[Mask.mask,:]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.nan</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(VNarr[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.save(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"VNarrData.npy"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,VNarr)</span></span>
<span class=line></span>
<span class=line></span>
<span class=line></span></code></pre></div><div class=code-block-wrapper><button aria-label="Copy code" class=code-copy-button type=button></button><pre class="astro-code astro-code-themes github-dark github-light" data-copy-button-added=true data-language=python style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # Load Data</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># </span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spectral </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> spy</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>poly </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [</span><span style=color:#005cc5;--shiki-dark:#79B8FF>120.85938</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>36.95460</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>121.52334</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>36.822677</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> matplotlib.pyplot </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> plt</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>PCs</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.load(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"VNPCs.npy"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#e36209;--shiki-dark:#FFAB70>allow_pickle</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>Mask </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.load(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"mask.npy"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>PCs[Mask,:]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.nan</span></span>
<span class=line></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pyresample</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> swath_resampling</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(src_data: np.ma.array, src_lon: np.array, src_lat: np.array,</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>                     trg_lon: np.array, trg_lat: np.array, search_radius: </span><span style=color:#005cc5;--shiki-dark:#79B8FF>float</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    if</span><span style=color:#005cc5;--shiki-dark:#79B8FF> len</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(trg_lon.shape) </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        grid_def </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pyresample.geometry.SwathDefinition(</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>            *</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.meshgrid(trg_lon, trg_lat))</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    else</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        grid_def </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pyresample.geometry.SwathDefinition(</span></span>
<span class=line><span style=color:#e36209;--shiki-dark:#FFAB70>            lons</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>trg_lon, </span><span style=color:#e36209;--shiki-dark:#FFAB70>lats</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>trg_lat)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # source grid with original swath data</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    swath_def </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pyresample.geometry.SwathDefinition(</span><span style=color:#e36209;--shiki-dark:#FFAB70>lons</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>src_lon, </span><span style=color:#e36209;--shiki-dark:#FFAB70>lats</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>src_lat)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # resample (here we use nearest. Bilinear, gaussian and custom defined methods are available)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    # for more, visit https://pyresample.readthedocs.io/en/latest/</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    result </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> pyresample.kd_tree.resample_nearest(swath_def, src_data, grid_def, </span><span style=color:#e36209;--shiki-dark:#FFAB70>epsilon</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span></span>
<span class=line><span style=color:#e36209;--shiki-dark:#FFAB70>                                                 fill_value</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>None</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>radius_of_influence</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>search_radius)</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> result, grid_def</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # Read S3</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3path</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"/mnt/f/S3B_OL_2_WFR____20220404T014531_20220404T014831_20220405T105330_0180_064_231_2340_MAR_O_NT_003/S3B_OL_2_WFR____20220404T014531_20220404T014831_20220405T105330_0180_064_231_2340_MAR_O_NT_003.SEN3"</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xarray </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xr</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> numpy </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> matplotlib.pyplot </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> plt</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>from</span><span style=color:#24292e;--shiki-dark:#E1E4E8> matplotlib </span><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> gridspec</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> os</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> warnings</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> cartopy.crs </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> ccrs</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> cartopy.feature </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> cfeature</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>file_name_chl </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'chl_nn.nc'</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>file_name_tsm </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'tsm_nn.nc'</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>file_name_geo </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'geo_coordinates.nc'</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>GEO_file</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xr.open_dataset(os.path.join(S3path, file_name_geo))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>LAT</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#005cc5;--shiki-dark:#79B8FF> GEO_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.variables[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'latitude'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>][:]</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>LON</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#005cc5;--shiki-dark:#79B8FF> GEO_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.variables[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'longitude'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>][:]</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>GEO_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.close()</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>def</span><span style=color:#6f42c1;--shiki-dark:#B392F0> flag_data_fast</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(flags_we_want, flag_names, flag_values, flag_data, flag_type</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'WQSF'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    flag_bits </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.uint64()</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    if</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_type </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'SST'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        flag_bits </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.uint8()</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    elif</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_type </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'WQSF_lsb'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        flag_bits </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.uint32()</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flags_we_want:</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        try</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>            flag_bits </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_bits </span><span style=color:#d73a49;--shiki-dark:#F97583>|</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_values[flag_names.index(flag)]</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>        except</span><span style=color:#24292e;--shiki-dark:#E1E4E8>:</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>            print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(flag </span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#032f62;--shiki-dark:#9ECBFF> " not present"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>    return</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (flag_data </span><span style=color:#d73a49;--shiki-dark:#F97583>&#x26;</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_bits) </span><span style=color:#d73a49;--shiki-dark:#F97583>></span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flags_we_want </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'CLOUD'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>file_name_flags </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF> 'wqsf.nc'</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>FLAG_file</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xr.open_dataset(os.path.join(</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    S3path, file_name_flags))</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># get all the flag names</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flag_names </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> FLAG_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'WQSF'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>].flag_meanings.split(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>' '</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># get all the flag bit values</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flag_vals </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF> FLAG_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'WQSF'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>].flag_masks</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># get the flag field itself</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>FLAGS</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#005cc5;--shiki-dark:#79B8FF> FLAG_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.variables[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'WQSF'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>].data</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>FLAG_file</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.close()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># make the flag mask using the function we defined above "flag_data_fast"</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flag_mask </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_data_fast(flags_we_want, flag_names,</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>                           flag_vals, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>FLAGS</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>flag_type</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'WQSF'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flag_mask </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> flag_mask.astype(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>float</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>flag_mask[flag_mask </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#005cc5;--shiki-dark:#79B8FF> 0.0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>] </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.nan</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#load CHL_NN</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>OLCI_file_CHL</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xr.open_dataset(os.path.join(</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    S3path, file_name_chl))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>CHL_NN</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#005cc5;--shiki-dark:#79B8FF> OLCI_file_CHL</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.variables[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'CHL_NN'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>][:].data</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>CHL_NN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[np.isfinite(flag_mask)] </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.nan</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>OLCI_file_CHL</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.close()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#load TSM_NN</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>OLCI_file_TSM</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8> xr.open_dataset(os.path.join(</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    S3path , file_name_tsm))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>TSM_NN</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#005cc5;--shiki-dark:#79B8FF> OLCI_file_TSM</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.variables[</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'TSM_NN'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>][:].data</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>TSM_NN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[np.isfinite(flag_mask)] </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.nan</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>OLCI_file_TSM</span><span style=color:#24292e;--shiki-dark:#E1E4E8>.close()</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %% [markdown]</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># # Resample</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(np.shape(PCs))</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(poly)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#def swath_resampling(src_data: np.ma.array, src_lon: np.array, src_lat: np.array,</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#                     trg_lon: np.array, trg_lat: np.array, search_radius: float):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>ZYlon</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.linspace(poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],</span><span style=color:#e36209;--shiki-dark:#FFAB70>num</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(PCs)[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>ZYlat</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.linspace(poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],</span><span style=color:#e36209;--shiki-dark:#FFAB70>num</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(PCs)[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(ZYlat)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3lon</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.arange(poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>2</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],</span><span style=color:#e36209;--shiki-dark:#FFAB70>step</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.003</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3lat</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.arange(poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],poly[</span><span style=color:#005cc5;--shiki-dark:#79B8FF>3</span><span style=color:#24292e;--shiki-dark:#E1E4E8>],</span><span style=color:#e36209;--shiki-dark:#FFAB70>step</span><span style=color:#d73a49;--shiki-dark:#F97583>=-</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.003</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3_chl,grid</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>swath_resampling(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>CHL_NN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>LON</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>LAT</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,S3lon,S3lat,</span><span style=color:#e36209;--shiki-dark:#FFAB70>search_radius</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>10000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(S3_chl)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3_tsm,grid</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>swath_resampling(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>TSM_NN</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>LON</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>LAT</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,S3lon,S3lat,</span><span style=color:#e36209;--shiki-dark:#FFAB70>search_radius</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>10000</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(S3_tsm)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>np.shape(S3_tsm)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> cv2</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>PCsUp</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ones((</span><span style=color:#005cc5;--shiki-dark:#79B8FF>44</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>222</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>))</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> cv2</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    PCsUp[:,:,i]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>cv2.resize(PCs[:,:,i],(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>222</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>44</span><span style=color:#24292e;--shiki-dark:#E1E4E8>),</span><span style=color:#e36209;--shiki-dark:#FFAB70>interpolation</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>cv2.</span><span style=color:#005cc5;--shiki-dark:#79B8FF>INTER_CUBIC</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(PCsUp[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>])</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3_chl</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ma.masked_invalid(S3_chl)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>S3_tsm</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ma.masked_invalid(S3_tsm)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>PCsUp[S3_chl.mask,:]</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.nan</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>PCsUpMasked</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ma.masked_invalid(PCsUp)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#from pylr2 import regress2</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(i</span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    r</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>np.ma.corrcoef(PCsUpMasked[:,:,i].flatten(),S3_chl.flatten())</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(r)</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>for</span><span style=color:#24292e;--shiki-dark:#E1E4E8> i </span><span style=color:#d73a49;--shiki-dark:#F97583>in</span><span style=color:#005cc5;--shiki-dark:#79B8FF> range</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>5</span><span style=color:#24292e;--shiki-dark:#E1E4E8>):</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(i</span><span style=color:#d73a49;--shiki-dark:#F97583>+</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    r </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> np.ma.corrcoef(PCsUpMasked[:, :, i].flatten(), S3_tsm.flatten())</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(r)</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>import</span><span style=color:#24292e;--shiki-dark:#E1E4E8> statsmodels.api </span><span style=color:#d73a49;--shiki-dark:#F97583>as</span><span style=color:#24292e;--shiki-dark:#E1E4E8> sm</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>model</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>sm.OLS(S3_chl.flatten(),PCsUpMasked[:,:,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>].flatten(),</span><span style=color:#e36209;--shiki-dark:#FFAB70>missing</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'drop'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#e36209;--shiki-dark:#FFAB70>hasconst</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>chlre</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>model.fit()</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(chlre.summary())</span></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>model </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> sm.OLS(S3_tsm.flatten(),</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>               PCsUpMasked[:, :, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>].flatten(), </span><span style=color:#e36209;--shiki-dark:#FFAB70>missing</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'drop'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#e36209;--shiki-dark:#FFAB70>hasconst</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#005cc5;--shiki-dark:#79B8FF>True</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>tsmre </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> model.fit()</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>print</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(tsmre.summary())</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(PCs[:, :, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span><span style=color:#d73a49;--shiki-dark:#F97583>*-</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.0220</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.title(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'Chl'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D># %%</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.imshow(PCs[:, :, </span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span><span style=color:#d73a49;--shiki-dark:#F97583>*</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0.0158</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.colorbar()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>plt.title(</span><span style=color:#032f62;--shiki-dark:#9ECBFF>'tsm'</span><span style=color:#24292e;--shiki-dark:#E1E4E8>)</span></span>
<span class=line></span>
<span class=line></span>
<span class=line></span></code></pre></div><p>准确度可以说是不能用的地步，懒得改了，就这样吧</p><div id=post-copyright></div><div class="mt-12.6 uno-decorative-line"></div><div class="flex flex-wrap gap-x-3 gap-y-3.2 no-heti"><a href="/tags/Ocean Color/" class="hover:c-primary border border-secondary/25 ease-out hover:border-secondary/80 hover:font-medium hover:ring-0.2 inline-block px-3.2 py-0.7 relative ring-0 ring-secondary/80 rounded-full transition-[colors,box-shadow]"><span class="flex absolute inset-0 items-center justify-center transition-font-weight whitespace-nowrap">Ocean Color </span><span class="inline-block font-medium opacity-0" aria-hidden=true>Ocean Color </span></a><a href=/tags/Hyperspectral/ class="hover:c-primary border border-secondary/25 ease-out hover:border-secondary/80 hover:font-medium hover:ring-0.2 inline-block px-3.2 py-0.7 relative ring-0 ring-secondary/80 rounded-full transition-[colors,box-shadow]"><span class="flex absolute inset-0 items-center justify-center transition-font-weight whitespace-nowrap">Hyperspectral </span><span class="inline-block font-medium opacity-0" aria-hidden=true>Hyperspectral</span></a></div></div></article></main><footer class="font-navbar leading-1.25em lg:text-3.5 text-3" lg="uno-desktop-column bottom-20"><p><a href=/atom.xml/ class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>RSS</a>&nbsp;/ <a href=https://github.com/lifeodyssey class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>GitHub</a>&nbsp;/ <a href=mailto:email@radishzz.cc class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Email</a>&nbsp;</p><p>© 2025-2026 周大侠</p><p>Powered by <a href=https://astro.build/ class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Astro</a> and <a href=https://github.com/radishzzz/astro-theme-retypeset class="hover:c-primary highlight-hover after:bottom-0.35em py-0.8 transition-colors" rel="noopener noreferrer" target=_blank>Retypeset</a></p></footer></div><div class="flex absolute gap-6 lg:bottom-[min(10.27rem+1.92vw,12rem)] lg:fixed lg:right-[max(5rem,calc(50vw-35rem))] lg:top-auto lg:w-14rem min-[823px]:max-lg:right-[calc(50vw-22rem)] right-7.25vw top-14.6"><a href=/posts/6c4d8823.html.html/ class="hover:c-primary active:scale-90 aspect-square c-secondary w-4" aria-label="Switch website language" id=language-switcher><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M19.18 21.1 12.4 1.89h-1.21L4.52 21.1l-2.53.2v.81h6.37v-.81l-2.83-.2 2.02-5.97h7.58l2.02 5.97-3.34.2v.81H22v-.81l-2.83-.2zM7.85 14.33l3.44-10.21 3.54 10.21z"/></svg> </a><button aria-label="Switch light/dark theme" class="hover:c-primary active:scale-90 aspect-square c-secondary w-4" id=theme-toggle-button><svg aria-hidden=true fill=currentColor viewBox="0 0 24 24"><path d="M12.06.61C5.66.61.46 5.71.46 12.11s5.1 11.5 11.6 11.5 11.5-5.1 11.5-11.5S18.46.61 12.06.61m0 21c-6.07 0-10.94-4.2-10.94-9.5s4.87-9.4 10.94-9.4S23 6.91 23 12.21s-4.88 9.4-10.94 9.4"/></svg></button></div><script>!function(){const e="oklch(96% 0.005 298)",t="oklch(22% 0.005 298)";function n(n){document.documentElement.classList.toggle("dark",n);const o=document.head.querySelector('meta[name="theme-color"]');o&&e&&t&&o.setAttribute("content",n?t:e),localStorage.setItem("theme",n?"dark":"light"),document.dispatchEvent(new Event("theme-changed"))}function o(){n(!document.documentElement.classList.contains("dark"))}document.addEventListener("click",(function(e){const t=e.target instanceof Element?e.target:null,n=t?.closest("#theme-toggle-button");if(!n)return;if(document.documentElement.classList.contains("reduce-motion"))return void o();document.documentElement.style.setProperty("view-transition-name","animation-theme-toggle"),document.documentElement.setAttribute("data-theme-changing",""),document.startViewTransition(o).finished.then((()=>{document.documentElement.style.removeProperty("view-transition-name"),document.documentElement.removeAttribute("data-theme-changing")}))}),{passive:!0}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{n(e.matches)}))}()</script><script type=module>const o={click:"tap",typing:"type"},l={[o.click]:.8,[o.typing]:.4},d=["#language-switcher","#theme-toggle-button"],f=[".el-input__inner",".el-textarea__inner","#wl-nick","#wl-mail","#wl-link","#wl-edit"],h=new Set(["Shift","Control","Alt","Meta","Tab","Escape","CapsLock"]),p=d.join(","),g=f.join(",");function r(){return window.matchMedia("(max-width: 1023px)").matches}function w(){return document.head.querySelector('link[rel="sitemap"]')?.getAttribute("href")?.replace("/sitemap-index.xml","")||""}class y{audioContext=null;audioBuffers={[o.click]:[],[o.typing]:[]};initPromise=null;async fetchAndCacheSound(t,e){if(!this.audioContext)throw new Error("Audio context not initialized");const n=`${t}_0${e+1}`,i=await(await fetch(`${w()}/sounds/${n}.wav`)).arrayBuffer(),a=await this.audioContext.decodeAudioData(i);this.audioBuffers[t].push(a)}async preloadAllSounds(){const t=Object.values(o).flatMap((t=>Array.from({length:5},((e,n)=>this.fetchAndCacheSound(t,n)))));await Promise.allSettled(t)}async initialize(){return this.initPromise??=(async()=>{const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t,await this.preloadAllSounds()})()}async playSound(t){try{if(await this.initialize(),!this.audioContext)return;"suspended"===this.audioContext.state&&await this.audioContext.resume();const e=this.audioBuffers[t];if(0===e.length)return;const n=this.audioContext.createBufferSource();n.buffer=e[Math.floor(Math.random()*e.length)];const i=this.audioContext.createGain();i.gain.value=l[t],n.connect(i).connect(this.audioContext.destination),n.start(0)}catch(t){console.warn("Sound playback failed:",t)}}}const c=new y;function m(t){r()||!t.target?.closest(p)||c.playSound(o.click)}function x(t){r()||t.ctrlKey||t.altKey||t.metaKey||h.has(t.key)||!t.target?.closest(g)||c.playSound(o.typing)}document.addEventListener("click",m,{passive:!0}),document.addEventListener("keydown",x,{passive:!0})</script><script type=module>const s={copy:'<svg\n      viewBox="0 0 24 24"\n      fill="currentColor"\n    >\n      <path d="M6.9.8v18h14.5V.8zm12.8 16h-11v-14h11z"/>\n      <path d="M4.3 21.2V5.6l-1.7.5v17.1h14.3l.6-2z"/>\n    </svg>',success:'<svg\n      viewBox="0 0 24 24"\n      fill="currentColor"\n    >\n      <path d="m23.1 6.4-1.3-1.3L9.4 16.6l-6.3-5.4-1.2 1.2L9.4 20z"/>\n    </svg>'},o=new WeakMap;function r(){const e=document.querySelectorAll(".code-copy-button");0!==e.length&&e.forEach((e=>{e.innerHTML=s.copy}))}async function a(e){if(e.classList.contains("copy-success"))return;const t=e.parentElement?.querySelector("pre code"),n=t?.textContent??"";if(t&&n)try{await navigator.clipboard.writeText(n);const t=o.get(e);t&&clearTimeout(t),e.innerHTML=s.success,e.classList.add("copy-success");const c=setTimeout((()=>{e.isConnected&&(e.innerHTML=s.copy,e.classList.remove("copy-success"),o.delete(e))}),1500);o.set(e,c)}catch(e){console.error("Failed to copy code",e)}}function l(e){const t=e.target instanceof Element&&e.target.closest(".code-copy-button");t&&a(t)}document.addEventListener("astro:page-load",r),document.addEventListener("click",l,{passive:!0}),r()</script><script type=module>async function p(t){const e=t.dataset.repo;if(!e)return;const o=t.getElementsByClassName("gc-owner-avatar")[0],n=t.getElementsByClassName("gc-repo-description")[0],s=t.getElementsByClassName("gc-stars-count")[0],a=t.getElementsByClassName("gc-forks-count")[0],r=t.getElementsByClassName("gc-license-info")[0];function c(t){const e=new Intl.NumberFormat("en",{notation:"compact",maximumFractionDigits:1});o&&t.owner?.avatar_url&&(o.style.backgroundImage=`url(${t.owner.avatar_url})`),n&&(n.textContent=t.description??"No description"),s&&(s.textContent=e.format(t.stargazers_count??0)),a&&(a.textContent=e.format(t.forks_count??0)),r&&(r.textContent=t.license?.spdx_id??"No License")}const i=`github-repo-${e}`,m=sessionStorage.getItem(i);if(m){c(JSON.parse(m))}else try{const t=await fetch(`https://api.github.com/repos/${e}`);if(!t.ok){if(n){const e=404===t.status?"Repository not found":"Failed to load repository data";n.textContent=e}return}const o=await t.json();sessionStorage.setItem(i,JSON.stringify(o)),c(o)}catch(t){console.error(`Failed to fetch ${e}:`,t)}}function f(){const t=document.getElementsByClassName("gc-container");0!==t.length&&Array.from(t).forEach((t=>{p(t)}))}document.addEventListener("astro:page-load",f),f()</script><script type=module src=/_astro/MediaEmbed.astro_astro_type_script_index_0_lang.wKrCMCCr.js></script><script type=module>const n={overlay:document.querySelector(".zoom-overlay"),zoomedImg:null,originalImg:null,createOverlay(){this.overlay&&this.overlay.isConnected||(this.overlay=document.createElement("div"),this.overlay.classList.add("zoom-overlay"),this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-label","Image Viewer"),this.overlay.setAttribute("tabindex","-1"),Object.assign(this.overlay.style,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",zIndex:"999",backgroundColor:"oklch(var(--un-preset-theme-colors-background) / 0.95)",opacity:"0",transition:"opacity 300ms cubic-bezier(0.4, 0, 0.2, 1)",cursor:"zoom-out",display:"none"}),document.body.appendChild(this.overlay))},zoomImg(e){if(!this.overlay)return;document.body.style.overflow="hidden";const t=e.getBoundingClientRect();this.originalImg=e,this.zoomedImg=e.cloneNode(),Object.assign(this.zoomedImg.style,{position:"fixed",top:`${t.top}px`,left:`${t.left}px`,width:`${t.width}px`,height:`${t.height}px`,transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1)",zIndex:"1000",cursor:"zoom-out"}),document.body.appendChild(this.zoomedImg),this.overlay.style.display="block",this.overlay.focus();const o=window.innerWidth,i=window.innerHeight,s=window.innerWidth<768?1:.8,l=Math.min(o*s/t.width,i*s/t.height),a=(-t.left+(o-t.width)/2)/l,n=(-t.top+(i-t.height)/2)/l;requestAnimationFrame((()=>{this.overlay&&(this.overlay.style.opacity="1"),this.zoomedImg&&(this.zoomedImg.style.transform=`scale(${l}) translate3d(${a}px, ${n}px, 0)`)}))},close(){!this.overlay||!this.zoomedImg||!this.originalImg||(this.zoomedImg.style.transform="",this.overlay.style.opacity="0",document.body.style.overflow="",setTimeout((()=>{this.zoomedImg&&this.zoomedImg.parentNode&&document.body.removeChild(this.zoomedImg),this.zoomedImg=null,this.overlay&&(this.overlay.style.display="none"),this.originalImg&&this.originalImg.focus(),this.originalImg=null}),300))},setupOverlay(){this.createOverlay(),this.zoomedImg=null,this.originalImg=null},handleClick(e){if(this.zoomedImg)return void this.close();const t=e.target;t instanceof HTMLImageElement&&t.complete&&t.naturalWidth>=100&&t.naturalHeight>=100&&this.zoomImg(t)},handleResize(){this.zoomedImg&&this.close()},init(){this.createOverlay(),document.addEventListener("astro:page-load",(()=>this.setupOverlay())),document.addEventListener("click",(e=>this.handleClick(e)),{passive:!0}),window.addEventListener("resize",(()=>this.handleResize()),{passive:!0})}};n.init()</script></body></html>