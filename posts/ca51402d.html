<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color media="(prefers-color-scheme: light)"><meta content=#222 name=theme-color media="(prefers-color-scheme: dark)"><meta content="Hexo 8.0.0" name=generator><link href=/images/apple-touch-icon-next.png rel=apple-touch-icon sizes=180x180><link href=/images/favicon-32x32-next.png rel=icon sizes=32x32 type=image/png><link href=/images/favicon-16x16-next.png rel=icon sizes=16x16 type=image/png><link href=/images/logo.svg rel=mask-icon color=#222><link href=/css/main.css rel=stylesheet><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM="><link href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet crossorigin=anonymous integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE="><script class=next-config data-name=main type=application/json>{"hostname":"lifeodyssey.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.25.0","exturl":true,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"base16/tomorrow-night"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"max"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src=/js/config.js defer=defer></script><meta content="æœ€è¿‘åœ¨è®¾ç½®AWS Inspectorçš„æ—¶å€™å‘ç°çš„ä¸€ä¸ªç¥å¥‡å¾ªç¯ã€‚ ï¼ˆæ–‡ç« å†™äº2025å¹´3.13ï¼Œåç»­awså¯èƒ½æœ‰æ›´æ–°ï¼‰" name=description><meta content=article property=og:type><meta content="ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ" property=og:title><meta content=https://lifeodyssey.github.io/posts/ca51402d.html property=og:url><meta content=ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹ property=og:site_name><meta content="æœ€è¿‘åœ¨è®¾ç½®AWS Inspectorçš„æ—¶å€™å‘ç°çš„ä¸€ä¸ªç¥å¥‡å¾ªç¯ã€‚ ï¼ˆæ–‡ç« å†™äº2025å¹´3.13ï¼Œåç»­awså¯èƒ½æœ‰æ›´æ–°ï¼‰" property=og:description><meta content=en_US property=og:locale><meta content=2025-03-13T11:22:56.000Z property=article:published_time><meta content=2025-09-30T12:13:35.396Z property=article:modified_time><meta content=å‘¨å¤§ä¾  property=article:author><meta content=AWS property=article:tag><meta content=DevOps property=article:tag><meta content="Software Engineering" property=article:tag><meta content=summary name=twitter:card><link href=https://lifeodyssey.github.io/posts/ca51402d.html rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://lifeodyssey.github.io/posts/ca51402d.html","path":"posts/ca51402d.html","title":"ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ | ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹</title><script src="https://www.googletagmanager.com/gtag/js?id=UA-135697820-1" async></script><script class=next-config data-name=google_analytics type=application/json>{"tracking_id":"UA-135697820-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src=/js/third-party/analytics/google-analytics.js defer=defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js defer=defer crossorigin=anonymous integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY="></script><script src=/js/utils.js defer=defer></script><script src=/js/motion.js defer=defer></script><script src=/js/sidebar.js defer=defer></script><script src=/js/next-boot.js defer=defer></script><script src=/js/bookmark.js defer=defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js defer=defer crossorigin=anonymous integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg="></script><script src=/js/third-party/search/local-search.js defer=defer></script><script class=next-config data-name=pdf type=application/json>{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script><script src=/js/third-party/tags/pdf.js defer=defer></script><script class=next-config data-name=mermaid type=application/json>{"enable":true,"theme":"forest","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script><script src=/js/third-party/tags/mermaid.js defer=defer></script><script class=next-config data-name=enableMath type=application/json>false</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src=/js/third-party/math/mathjax.js defer=defer></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link href=/atom.xml rel=alternate type=application/atom+xml title=ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹></head><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button aria-label="Toggle navigation bar"><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div></div><div class=site-meta><a href=/ rel=start class=brand><i class=logo-line></i><p class=site-title>ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹</p><i class=logo-line></i></a></div><div class=site-nav-right><div class="toggle popup-trigger" role=button aria-label=Search><i class="fa fa-fw fa-search fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-fw fa-user"></i>About</a></li><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-fw fa-tags"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-fw fa-th"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-fw fa-archive"></i>Archives</a></li><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-fw fa-search"></i>Search</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=Searching... spellcheck=false type=search></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-5x fa-pulse fa-spinner"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>Table of Contents</li><li class=sidebar-nav-overview>Overview</li></ul><div class=sidebar-panel-container><div class="sidebar-panel post-toc-wrap"><div class="animated post-toc"><ol class=nav><li class="nav-item nav-level-1"><a href=#aws-inspector%E5%8F%8A%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82%E4%BB%8B%E7%BB%8D class=nav-link><span class=nav-number>1.</span> <span class=nav-text>AWS InspectoråŠä¸šåŠ¡éœ€æ±‚ä»‹ç»</span></a><ol class=nav-child><li class="nav-item nav-level-2"><a href=#%E7%A5%9E%E5%A5%87%E7%9A%84api%E4%B8%8E%E7%95%8C%E9%9D%A2%E4%B8%8D%E5%8C%B9%E9%85%8D class=nav-link><span class=nav-number>1.1.</span> <span class=nav-text>1.ç¥å¥‡çš„APIä¸ç•Œé¢ä¸åŒ¹é…</span></a></li><li class="nav-item nav-level-2"><a href=#inspector%E4%B8%8Eecr%E7%9A%84%E5%85%B3%E8%81%94 class=nav-link><span class=nav-number>1.2.</span> <span class=nav-text>2.Inspectorä¸ECRçš„å…³è”</span></a></li><li class="nav-item nav-level-2"><a href=#%E5%88%A9%E7%94%A8terraform%E6%97%B6%E7%9A%84%E7%A5%9E%E5%A5%87%E5%BE%AA%E7%8E%AF class=nav-link><span class=nav-number>1.3.</span> <span class=nav-text>3. åˆ©ç”¨Terraformæ—¶çš„ç¥å¥‡å¾ªç¯</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a href=#mermaid-%E5%9B%BE%E5%B1%95%E7%A4%BA-terraform-%E5%91%A8%E6%9C%9F%E8%A1%8C%E4%B8%BA class=nav-link><span class=nav-number>1.3.1.</span> <span class=nav-text>Mermaid å›¾å±•ç¤º Terraform å‘¨æœŸè¡Œä¸º</span></a></li></ol></li><li class="nav-item nav-level-2"><a href=#potential-reason class=nav-link><span class=nav-number>1.4.</span> <span class=nav-text>4. Potential Reason</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a href=#%E9%AA%8C%E8%AF%81%E6%89%8B%E5%8A%A8%E9%87%8D%E7%8E%B0%E5%BE%AA%E7%8E%AF class=nav-link><span class=nav-number>1.4.1.</span> <span class=nav-text>éªŒè¯ï¼šæ‰‹åŠ¨é‡ç°å¾ªç¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a href=#solution class=nav-link><span class=nav-number>1.5.</span> <span class=nav-text>5. solution</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a href=#%E8%BF%99%E4%B8%AA%E6%96%B9%E6%A1%88%E7%9A%84%E4%BC%98%E5%8A%BF class=nav-link><span class=nav-number>1.5.1.</span> <span class=nav-text>è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿</span></a></li><li class="nav-item nav-level-3"><a href=#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E6%95%88%E6%9E%9C class=nav-link><span class=nav-number>1.5.2.</span> <span class=nav-text>å®é™…åº”ç”¨æ•ˆæœ</span></a></li></ol></li><li class="nav-item nav-level-2"><a href=#sum-up class=nav-link><span class=nav-number>1.6.</span> <span class=nav-text>6. Sum up</span></a></li></ol></li></ol></div></div><!--/noindex--><div class="sidebar-panel site-overview-wrap"><div class="animated site-author" itemprop=author itemscope itemtype=http://schema.org/Person><p class=site-author-name itemprop=name>å‘¨å¤§ä¾ </p><div class=site-description itemprop=description></div></div><div class="animated site-state-wrap"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/ ><span class=site-state-item-count>165</span> <span class=site-state-item-name>posts</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/ ><span class=site-state-item-count>17</span> <span class=site-state-item-name>categories</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/ ><span class=site-state-item-count>97</span> <span class=site-state-item-name>tags</span></a></div></nav></div><div class="animated links-of-author"><span class=links-of-author-item><span class=exturl data-url=aHR0cHM6Ly9naXRodWIuY29tL2xpZmVvZHlzc2V5 title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;lifeodyssey"><i class="fa-fw fab fa-github"></i>GitHub</span> </span><span class=links-of-author-item><span class=exturl data-url="bWFpbHRvOnpoZW5qaWF6aG91MDEyN0BnbWFpbC5jb20=" title="E-Mail â†’ mailto:zhenjiazhou0127@gmail.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span> </span><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly93d3cucmVzZWFyY2hnYXRlLm5ldC9wcm9maWxlL1poZW5qaWFfWmhvdQ==" title="Researchgate â†’ https:&#x2F;&#x2F;www.researchgate.net&#x2F;profile&#x2F;Zhenjia_Zhou"><i class="fa fa-fw fa-researchgate"></i>Researchgate</span> </span><span class=links-of-author-item><span class=exturl data-url="aHR0cHM6Ly93d3cubGlua2VkaW4uY29tL2luL3poZW5qaWEtemhvdS8=" title="Linkedin â†’ https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;zhenjia-zhou&#x2F;"><i class="fa fa-fw fa-Linkedin"></i>Linkedin</span> </span><span class=links-of-author-item><a href=/atom.xml rel="noopener me" title="RSS â†’ &#x2F;atom.xml"><i class="fa-fw rss"></i>RSS</a></span></div><div class="animated cc-license" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9lbg=="><img src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg alt="Creative Commons"></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=en><link href=https://lifeodyssey.github.io/posts/ca51402d.html itemprop=mainEntityOfPage><span itemprop=author itemscope itemtype=http://schema.org/Person hidden><meta content=/images/avatar.gif itemprop=image><meta content=å‘¨å¤§ä¾  itemprop=name></span><span itemprop=publisher itemscope itemtype=http://schema.org/Organization hidden><meta content=ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹ itemprop=name><meta content="" itemprop=description></span><span itemprop=post itemscope itemtype=http://schema.org/CreativeWork hidden><meta content="ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ | ä¹”å…‹å”å”çš„åºŠè¾¹æ•…äº‹" itemprop=name><meta content="" itemprop=description></span><header class=post-header><h1 class=post-title itemprop="name headline">ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i> </span><span class=post-meta-item-text>Posted on</span> <time datetime=2025-03-13T19:22:56+08:00 itemprop="dateCreated datePublished" title="Created: 2025-03-13 19:22:56">2025-03-13</time> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder"></i> </span><span class=post-meta-item-text>In</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/Work-Note/ rel=index itemprop=url><span itemprop=name>Work Note</span></a> </span></span><span class=post-meta-break></span> <span class=post-meta-item title="Word count in article"><span class=post-meta-item-icon><i class="far fa-file-word"></i> </span><span class=post-meta-item-text>Word count in article: </span><span>6.7k</span> </span><span class=post-meta-item title="Reading time"><span class=post-meta-item-icon><i class="far fa-clock"></i> </span><span class=post-meta-item-text>Reading time &asymp;</span> <span>24 mins.</span></span></div></div></header><div class=post-body itemprop=articleBody><p>æœ€è¿‘åœ¨è®¾ç½®AWS Inspectorçš„æ—¶å€™å‘ç°çš„ä¸€ä¸ªç¥å¥‡å¾ªç¯ã€‚</p><p>ï¼ˆæ–‡ç« å†™äº2025å¹´3.13ï¼Œåç»­awså¯èƒ½æœ‰æ›´æ–°ï¼‰</p><span id=more></span><h1 id=aws-inspectoråŠä¸šåŠ¡éœ€æ±‚ä»‹ç»>AWS InspectoråŠä¸šåŠ¡éœ€æ±‚ä»‹ç»</h1><p>AWS Inspectoræ˜¯AWSæ¨å‡ºçš„ä¸€ä¸ªä¾èµ–åŒ…æ¼æ´æ‰«æçš„æœåŠ¡ï¼Œæ‰«æçš„å¯¹è±¡åŒ…æ‹¬lambda, EC2å’ŒECR Imageã€‚å®˜æ–¹ä»‹ç»çš„å–ç‚¹ä¹‹ä¸€æ˜¯ä»–æœ‰è‡ªå·±çš„ä¸€ä¸ªæ¼æ´æ•°æ®åº“ï¼Œå¦‚æœä½ æŠŠscançš„é¢‘ç‡è®¾ç½®ä¸ºâ€CONTINUOUS_SCANâ€ï¼Œæ¯å½“æœ‰æ–°çš„æ¼æ´å‘å¸ƒæ—¶ï¼Œå°±ä¼šå¯¹å·²ç»æ‰«æè¿‡çš„imageå†è¿›è¡Œä¸€æ¬¡æ‰«æï¼Œè€Œä¸æ˜¯åªåœ¨æŠŠimageæ¨åˆ°ecræ—¶è¿›è¡Œä¸€æ¬¡æ‰«æã€‚</p><p>å¯¹äºimageï¼Œå®˜æ–¹å®šä»·æ˜¯initial scan 0.9åˆ€ä¸€æ¬¡ï¼Œrescan0.1åˆ€ä¸€æ¬¡ã€‚å¬èµ·æ¥å¾ˆä¸é”™æ˜¯ä¸æ˜¯ï¼Œä½†æ˜¯é—®é¢˜åœ¨äºè¿™ä¸ªrescançš„é¢‘ç‡æ˜¯æ— æ³•è¿›è¡Œæ“æ§çš„ï¼Œæ¯”å¦‚ä½ çš„ä¸€ä¸ªimageæœ‰100ä¸ªä¾èµ–ï¼Œæ¯ä¸ªä¾èµ–ä¸€å¤©å‘ä¸€æ¬¡æ¼æ´æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ä¸€å¤©ä¸€ä¸ªimageå°±è¦èŠ±10åˆ€ã€‚ä»¥æˆ‘è‡ªå·±çš„ECRä¸ºä¾‹ï¼Œ45ä¸ªimageï¼Œinspectorç»™æˆ‘ä¼°è®¡çš„æ¯æœˆè¦åœ¨è¿™ä¸Šé¢èŠ±çš„é’±å¤§æ¦‚è¦240å¤šåˆ€ã€‚è¿™æ˜¯ä¸å¯æ¥å—çš„ï¼Œäºæ˜¯å°±åœ¨æ¢ç´¢å¦‚ä½•æ‰èƒ½æ§åˆ¶aws inspectorçš„è¡Œä¸ºã€‚</p><h2 id=ç¥å¥‡çš„apiä¸ç•Œé¢ä¸åŒ¹é…>1.ç¥å¥‡çš„APIä¸ç•Œé¢ä¸åŒ¹é…</h2><p>å…ˆå»æŸ¥çœ‹äº†<a href=%5BTerraform%20Registry%5D(https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecr_registry_scanning_configuration)>Terraformçš„æ–‡æ¡£</a> <img src=https://raw.githubusercontent.com/lifeodyssey/Figurebed/master/20250313150745.png /></p><p>ä¸<span class=exturl data-url="aHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2phX2pwL0FtYXpvbkVDUi9sYXRlc3QvQVBJUmVmZXJlbmNlL0FQSV9SZXBvc2l0b3J5U2Nhbm5pbmdDb25maWd1cmF0aW9uLmh0bWw=">AWSæ–‡æ¡£<i class="fa fa-external-link-alt"></i></span></p><p><img src=https://raw.githubusercontent.com/lifeodyssey/Figurebed/master/202503131509510.png /></p><p>è¿™é‡Œéƒ½æœ‰manualè¿™ä¸ªé€‰é¡¹ï¼Œä½†æ˜¯åœ¨consolesä¸Šéƒ½çœ‹ä¸åˆ°æœ‰å“ªé‡Œèƒ½manualè§¦å‘ã€‚</p><p>æ€€ç€è¿™ä¸ªç–‘é—®ï¼Œæˆ‘å¼€å§‹å°è¯•åœ¨ç½‘é¡µä¸Šç†è§£Inspectorå’ŒECRçš„è¡Œä¸º</p><h2 id=inspectorä¸ecrçš„å…³è”>2.Inspectorä¸ECRçš„å…³è”</h2><pre class=mermaid>flowchart TD
    A[å¼€å§‹] --> B[ç›´æ¥æ¿€æ´»AWS Inspector]
    B --> C[Inspectorè‡ªåŠ¨é…ç½®]
    C --> D[æ‰«ææ‰€æœ‰èµ„æº]
    D --> E1[æ‰«æECRé•œåƒ]
    D --> E2[æ‰«æEC2å®ä¾‹]
    D --> E3[æ‰«æLambdaå‡½æ•°]
    E1 --> F[ç»“æŸï¼šå…¨é¢çš„å®‰å…¨æ‰«æè¦†ç›–]
    E2 --> F
    E3 --> F</pre><p><strong>åœºæ™¯1åˆ†æ</strong>ï¼šå½“æˆ‘åœ¨AWSæ§åˆ¶å°ä¸­ç›´æ¥æ¿€æ´»InspectoræœåŠ¡æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨é…ç½®ä¸ºæ‰«ææ‰€æœ‰æ”¯æŒçš„èµ„æºç±»å‹ã€‚è¿™åŒ…æ‹¬ECRä¸­çš„å®¹å™¨é•œåƒã€EC2å®ä¾‹ä»¥åŠLambdaå‡½æ•°ã€‚è¿™æ˜¯æœ€ç›´æ¥çš„é…ç½®æ–¹å¼ï¼Œæä¾›äº†å…¨é¢çš„å®‰å…¨è¦†ç›–ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„æ‰«ææˆæœ¬ã€‚</p><pre class=mermaid>flowchart TD
    A[å¼€å§‹] --> B[åœç”¨AWS Inspector]
    B --> C[åœ¨ECRä¸­å¯ç”¨å¢å¼ºæ‰«æ]
    C --> D[Inspectorè‡ªåŠ¨åˆ›å»º]
    D --> E[ä»…æ‰«æECRé•œåƒ]
    E --> F[ç»“æŸï¼šä»…ECRé•œåƒè¢«æ‰«æ]</pre><p><strong>åœºæ™¯2åˆ†æ</strong>ï¼šæœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœæˆ‘å…ˆåœç”¨InspectoræœåŠ¡ï¼Œç„¶ååœ¨ECRé…ç½®ä¸­å¯ç”¨å¢å¼ºæ‰«æ(Enhanced Scan)ï¼ŒAWSä¼šè‡ªåŠ¨åˆ›å»ºInspectoræœåŠ¡å®ä¾‹ï¼Œä½†å®ƒåªé…ç½®ä¸ºæ‰«æECRé•œåƒï¼Œè€Œä¸åŒ…æ‹¬EC2æˆ–Lambdaã€‚è¿™ç§è¡Œä¸ºè¡¨æ˜ECRå¢å¼ºæ‰«æå®é™…ä¸Šä¾èµ–äºInspectoræœåŠ¡ã€‚</p><pre class=mermaid>flowchart TD
    A[å¼€å§‹] --> B[ç›´æ¥æ¿€æ´»AWS Inspector]
    B --> C[åœ¨ECRä¸­é€‰æ‹©åŸºç¡€æ‰«æ]
    C --> D[Inspectoré…ç½®æ›´æ–°]
    D --> E1[ç»§ç»­æ‰«æEC2å®ä¾‹]
    D --> E2[ç»§ç»­æ‰«æLambdaå‡½æ•°]
    D --> E3[åœæ­¢æ‰«æECRé•œåƒ]
    E1 --> F[ç»“æŸï¼šä»…EC2å’ŒLambdaè¢«æ‰«æ]
    E2 --> F
    E3 --> F</pre><p><strong>åœºæ™¯3åˆ†æ</strong>ï¼šæœ€æœ‰è¶£çš„æ˜¯ç¬¬ä¸‰ç§æƒ…å†µã€‚å¦‚æœæˆ‘å…ˆæ¿€æ´»Inspectorï¼Œç„¶ååœ¨ECRä¸­å°†æ‰«æç±»å‹æ›´æ”¹ä¸ºåŸºç¡€æ‰«æ(Basic)ï¼ŒInspectorä¼šç»§ç»­æ‰«æEC2å’ŒLambdaèµ„æºï¼Œä½†ä¼šåœæ­¢å¯¹ECRé•œåƒçš„æ‰«æã€‚è¿™è¡¨æ˜ECRçš„æ‰«æè®¾ç½®å¯ä»¥é€‰æ‹©æ€§åœ°å¯ç”¨æˆ–ç¦ç”¨Inspectorå¯¹é•œåƒçš„æ‰«æï¼Œè€Œä¸å½±å“å…¶ä»–èµ„æºç±»å‹ã€‚</p><pre class=mermaid>flowchart TD
    A[å¼€å§‹Terraformå¾ªç¯] --> B[ç¬¬ä¸€æ¬¡åº”ç”¨]
    B --> C[Inspectorå­˜åœ¨\nECRåŸºç¡€æ‰«æå¯ç”¨\nä¸æ‰«æé•œåƒ]

    C --> D[ç¬¬äºŒæ¬¡åº”ç”¨]
    D --> E[Inspectoræ˜¾ç¤ºä¸å­˜åœ¨\néœ€è¦é‡æ–°åˆ›å»º]
    E --> F[Inspectoré‡æ–°åˆ›å»º\nECRå¢å¼ºæ‰«æå¯ç”¨\nå¼€å§‹æ‰«æé•œåƒ]

    F --> G[ç¬¬ä¸‰æ¬¡åº”ç”¨] 
    G --> C

    C -.å¾ªç¯å¼€å§‹.-> D</pre><h2 id=åˆ©ç”¨terraformæ—¶çš„ç¥å¥‡å¾ªç¯>3. åˆ©ç”¨Terraformæ—¶çš„ç¥å¥‡å¾ªç¯</h2><p>æ—¢ç„¶Inspectoræ˜¯æ¯æ¬¡æ‰«ææ‰æ”¶è´¹ï¼Œå¹¶ä¸”æœ‰Inspectorçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠECRè®¾ç½®ä¸ºbasicï¼Œé‚£ä¹ˆæœ‰ä¸€ä¸ªæ–¹æ¡ˆæ˜¯ä¿ç•™Inspectorèµ„æºï¼ŒåŒæ—¶æŠŠECRè®¾ç½®ä¸ºbasicï¼Œç­‰åˆ°releaseçš„æ—¶å€™å¼€å¯ä¸€æ¬¡enhanced(å³Inspector)æ¥è¡¥æ¼æ´ã€‚</p><p>äºæ˜¯æˆ‘çš„ä»£ç æ˜¯è¿™ä¹ˆå†™çš„</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br><span class=line>36</span><br><span class=line>37</span><br><span class=line>38</span><br><span class=line>39</span><br><span class=line>40</span><br><span class=line>41</span><br><span class=line>42</span><br><span class=line>43</span><br><span class=line>44</span><br><span class=line>45</span><br><span class=line>46</span><br><span class=line>47</span><br><span class=line>48</span><br><span class=line>49</span><br><span class=line>50</span><br><span class=line>51</span><br><span class=line>52</span><br><span class=line>53</span><br><span class=line>54</span><br></pre></td><td class=code><pre><span class=line># è·å–å½“å‰ AWS è´¦æˆ· ID</span><br><span class=line>data &quot;aws_caller_identity&quot; &quot;current&quot; &#123;&#125;</span><br><span class=line></span><br><span class=line># AWS Inspector èµ„æºé…ç½®</span><br><span class=line>resource &quot;aws_inspector2_enabler&quot; &quot;this&quot; &#123;</span><br><span class=line>  account_ids    = [data.aws_caller_identity.current.account_id]</span><br><span class=line>  resource_types = [&quot;ECR&quot;]</span><br><span class=line></span><br><span class=line>  lifecycle &#123;</span><br><span class=line>    prevent_destroy = true  # é˜²æ­¢èµ„æºè¢«é”€æ¯</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line># ECR æ‰«æé…ç½®</span><br><span class=line>resource &quot;aws_ecr_registry_scanning_configuration&quot; &quot;configuration&quot; &#123;</span><br><span class=line>  scan_type = var.enable_scanning ? &quot;ENHANCED&quot; : &quot;BASIC&quot;</span><br><span class=line></span><br><span class=line>  # å½“å¯ç”¨å¢å¼ºæ‰«ææ—¶ï¼Œæ·»åŠ ç‰¹å®šè§„åˆ™</span><br><span class=line>  dynamic &quot;rule&quot; &#123;</span><br><span class=line>    for_each = var.enable_scanning ? [1] : []</span><br><span class=line>    content &#123;</span><br><span class=line>      scan_frequency = &quot;SCAN_ON_PUSH&quot;</span><br><span class=line>      repository_filter &#123;</span><br><span class=line>        filter      = var.scan_specific_repo ? &quot;example/repo&quot; : &quot;*&quot;</span><br><span class=line>        filter_type = &quot;WILDCARD&quot;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  # å½“ç¦ç”¨å¢å¼ºæ‰«ææ—¶ï¼Œæ·»åŠ é»˜è®¤è§„åˆ™</span><br><span class=line>  dynamic &quot;rule&quot; &#123;</span><br><span class=line>    for_each = var.enable_scanning ? [] : [1]</span><br><span class=line>    content &#123;</span><br><span class=line>      scan_frequency = &quot;SCAN_ON_PUSH&quot;</span><br><span class=line>      repository_filter &#123;</span><br><span class=line>        filter      = &quot;*&quot;</span><br><span class=line>        filter_type = &quot;WILDCARD&quot;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line># å˜é‡å®šä¹‰</span><br><span class=line>variable &quot;enable_scanning&quot; &#123;</span><br><span class=line>  description = &quot;æ˜¯å¦å¯ç”¨å¢å¼ºæ‰«æ&quot;</span><br><span class=line>  type        = bool</span><br><span class=line>  default     = false</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line>variable &quot;scan_specific_repo&quot; &#123;</span><br><span class=line>  description = &quot;æ˜¯å¦åªæ‰«æç‰¹å®šä»“åº“&quot;</span><br><span class=line>  type        = bool</span><br><span class=line>  default     = false</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨applyçš„æ—¶å€™å´äº§ç”Ÿäº†ç¥å¥‡çš„ç°è±¡</p><ol type=1><li><strong>ç¬¬ä¸€æ¬¡ <code>apply</code></strong>ï¼šInspector èµ„æºå­˜åœ¨ï¼ŒECR è®¾ç½®ä¸ºåŸºæœ¬æ‰«æï¼ˆBASICï¼‰ï¼Œä¸€åˆ‡çœ‹èµ·æ¥æ­£å¸¸ã€‚</li><li><strong>ç¬¬äºŒæ¬¡ <code>apply</code></strong>ï¼šTerraform çªç„¶è¯´ Inspector ä¸å­˜åœ¨ï¼Œéœ€è¦é‡æ–°åˆ›å»ºã€‚åˆ›å»ºåï¼ŒECR å˜æˆäº†å¢å¼ºæ‰«æï¼ˆENHANCEDï¼‰ã€‚</li><li><strong>ç¬¬ä¸‰æ¬¡ <code>apply</code></strong>ï¼šåˆå›åˆ°ç¬¬ä¸€æ¬¡çš„çŠ¶æ€ï¼ŒInspector å­˜åœ¨ï¼ŒECR å˜å›åŸºæœ¬æ‰«æï¼ˆBASICï¼‰ã€‚</li></ol><p>è¿™å¾ªç¯ç®€ç›´åƒä¸ªâ€œæ­»å¾ªç¯â€ï¼Œè®©æˆ‘å®Œå…¨æ‘¸ä¸ç€å¤´è„‘ã€‚æ˜æ˜ä»£ç æ²¡æ”¹ï¼ŒçŠ¶æ€å´ä¸€ç›´åœ¨è·³æ¥è·³å»ï¼ŒTerraform ä½ æ˜¯æƒ³å¹²å•¥ï¼Ÿ</p><h3 id=mermaid-å›¾å±•ç¤º-terraform-å‘¨æœŸè¡Œä¸º>Mermaid å›¾å±•ç¤º Terraform å‘¨æœŸè¡Œä¸º</h3><p>ä¸ºäº†æŠŠè¿™ä¸ªå¾ªç¯ç°è±¡è®²æ¸…æ¥šï¼Œæˆ‘ç”¨ Mermaid ç”»äº†ä¸ªæµç¨‹å›¾ï¼Œç›´è§‚å±•ç¤º Terraform åœ¨å¤šæ¬¡ <code>apply</code> æ—¶çš„çŠ¶æ€å˜åŒ–ï¼š</p><pre class=mermaid>graph TD
    A[Terraform apply 1] --> B[Inspector exist, ECR basic scan]
    B --> C[Terraform apply 2]
    C --> D[Inspector do not exist, recreate]
    D --> E[ECR enhanced scann]
    E --> F[Terraform apply 3]
    F --> B</pre><p>ä»å›¾é‡Œå¯ä»¥çœ‹åˆ°ï¼ŒçŠ¶æ€åœ¨ Bï¼ˆç¬¬ä¸€æ¬¡ï¼‰å’Œ Eï¼ˆç¬¬äºŒæ¬¡ï¼‰ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œç¬¬ä¸‰æ¬¡åˆå›åˆ° Bï¼Œå½¢æˆäº†é—­ç¯ã€‚è¿™è®©æˆ‘æ„Ÿè§‰ Terraform åƒæ˜¯ä¸­äº†ä»€ä¹ˆâ€œçŠ¶æ€è¯…å’’â€ã€‚</p><h2 id=potential-reason>4. Potential Reason</h2><p>ç”±æ­¤ï¼Œæˆ‘çŒœæµ‹ECRçš„configurationå’ŒInspectorä¹‹é—´å¹¶æ²¡æœ‰è¢«åˆ†ç¦»çš„å¾ˆå¥½ï¼Œå­˜åœ¨ä¸€äº›èƒŒåçš„å…³è”ã€‚</p><p><strong>ECR æ‰«æé…ç½®å’Œ Inspector çŠ¶æ€ä¹‹é—´å­˜åœ¨æŸç§éšå«çš„ä¾èµ–å…³ç³»</strong>ï¼Œè€Œä¸” AWS å¯èƒ½ä¼šåœ¨æŸäº›æ¡ä»¶ä¸‹è‡ªåŠ¨ç®¡ç† Inspector çš„ç”Ÿå‘½å‘¨æœŸã€‚å…·ä½“æ¥è¯´ï¼š</p><ol type=1><li><p><strong>ç¬¬ä¸€æ¬¡ apply</strong>ï¼šInspector å­˜åœ¨ï¼ŒECR è®¾ç½®ä¸ºåŸºæœ¬æ‰«æ(BASIC)ã€‚ä½†ç”±äº ECR ç”¨çš„æ˜¯åŸºæœ¬æ‰«æï¼ŒåŒæ—¶æˆ‘ä»¬åˆæ²¡æœ‰ä¸º EC2 å’Œ Lambda å¼€å¯æ‰«æï¼Œè¿™ç§æƒ…å†µä¸‹ Inspector å˜å¾—â€æ— äº‹å¯åšâ€ï¼Œ<strong>AWS å¯èƒ½ä¼šåœ¨åå°è‡ªåŠ¨é”€æ¯å®ƒ</strong>ã€‚</p></li><li><p><strong>ç¬¬äºŒæ¬¡ apply</strong>ï¼šTerraform æ£€æŸ¥æ—¶å‘ç° AWS ä¸Š Inspector å·²ä¸å­˜åœ¨ï¼ˆè¢« AWS è‡ªå·±å¹²æ‰äº†ï¼‰ï¼Œä½† Terraform çŠ¶æ€æ–‡ä»¶ä¸­å®ƒè¿˜åœ¨ï¼Œè¿™å°±å¯¼è‡´äº†çŠ¶æ€ä¸ä¸€è‡´ã€‚äºæ˜¯ Terraform é‡æ–°åˆ›å»º Inspectorï¼Œè€Œåˆ›å»ºåï¼Œ<strong>æ–°çš„ Inspector ä¼šè‡ªåŠ¨å°† ECR æ‰«ææ¨¡å¼è®¾ä¸ºå¢å¼ºæ‰«æ(ENHANCED)</strong>ã€‚</p></li><li><p><strong>ç¬¬ä¸‰æ¬¡ apply</strong>ï¼šInspector ç¡®å®å­˜åœ¨ï¼Œä½† ECR è¢«è®¾ç½®æˆäº†å¢å¼ºæ‰«æï¼Œè€Œæˆ‘ä»¬çš„ä»£ç è¦æ±‚å®ƒæ˜¯åŸºæœ¬æ‰«æã€‚æ‰€ä»¥ Terraform æ‰§è¡Œæ—¶åªä¼šä¿®æ”¹ ECR çš„æ‰«æç±»å‹ï¼ˆä»å¢å¼ºå˜ä¸ºåŸºæœ¬ï¼‰ï¼Œ<strong>ä¸ä¼šé”€æ¯ Inspector èµ„æº</strong>ã€‚ç„¶åï¼Œæˆ‘ä»¬å›åˆ°äº†ç¬¬ä¸€æ­¥çš„çŠ¶æ€ï¼Œå¾ªç¯å¼€å§‹â€¦</p></li></ol><p>å°±åƒæ˜¯ AWS å’Œ Terraform åœ¨ç©ä¸€ä¸ªâ€ä½ åˆ›æˆ‘åˆ ï¼Œä½ åˆ æˆ‘åˆ›â€çš„æ¸¸æˆï¼Œè€Œæˆ‘ä»¬å°±è¢«å›°åœ¨è¿™ä¸ªå¥‡æ€ªçš„å¾ªç¯ä¸­ã€‚</p><h3 id=éªŒè¯æ‰‹åŠ¨é‡ç°å¾ªç¯>éªŒè¯ï¼šæ‰‹åŠ¨é‡ç°å¾ªç¯</h3><p>ä¸ºäº†éªŒè¯æˆ‘çš„çŒœæµ‹ï¼Œæˆ‘å†³å®šæ‰‹åŠ¨åœ¨ AWS æ§åˆ¶å°ä¸Šé‡ç°è¿™ä¸ªè¿‡ç¨‹ï¼š</p><ol type=1><li>é¦–å…ˆåœ¨æ§åˆ¶å°ä¸Šå¯ç”¨ Inspectorï¼Œç„¶åå°† ECR è®¾ç½®ä¸ºåŸºæœ¬æ‰«æ(BASIC)</li><li>ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè§‚å¯Ÿåˆ° <strong>Inspector è¢«è‡ªåŠ¨ç¦ç”¨äº†</strong>ï¼è¿™è¯å®äº†æˆ‘çš„ç¬¬ä¸€ä¸ªçŒœæµ‹ï¼šåœ¨æ²¡æœ‰å¼€å¯å…¶ä»–èµ„æºæ‰«æçš„æƒ…å†µä¸‹ï¼Œçº¯ BASIC æ¨¡å¼ä¼šå¯¼è‡´ Inspector è‡ªåŠ¨è¢«ç¦ç”¨</li><li>ç„¶åï¼Œæˆ‘åœ¨è¿™ç§çŠ¶æ€ä¸‹ç›´æ¥æ‰‹åŠ¨å¯ç”¨ Inspector</li><li>ç»“æœç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼š<strong>ECR çš„æ‰«ææ¨¡å¼è‡ªåŠ¨ä» BASIC å˜æˆäº† ENHANCED</strong>ï¼è¿™éªŒè¯äº†æˆ‘çš„ç¬¬äºŒä¸ªçŒœæµ‹</li></ol><pre class=mermaid>graph TD
    A[å¼€å¯ Inspector] --> B[è®¾ç½® ECR ä¸º BASIC]
    B -->|ç­‰å¾…ä¸€æ®µæ—¶é—´| C[Inspector è‡ªåŠ¨è¢«ç¦ç”¨]
    C -->|æ‰‹åŠ¨é‡æ–°å¼€å¯ Inspector| D[ECR è‡ªåŠ¨å˜ä¸º ENHANCED]
    D -->|è®¾ç½® ECR ä¸º BASIC| B</pre><p>è¿™å®Œå…¨å°è¯äº† Terraform å¾ªç¯çš„æ ¹æœ¬åŸå› ï¼ç°åœ¨è¿™ä¸ªç°è±¡è§£é‡Šå¾—é€šäº†ï¼š<strong>AWS åœ¨åå°æœ‰ä¸€å¥—è‡ªå·±çš„é€»è¾‘ï¼Œä¼šæ ¹æ® ECR æ‰«æé…ç½®è‡ªåŠ¨ç®¡ç† Inspector çš„çŠ¶æ€ï¼Œåä¹‹äº¦ç„¶</strong>ã€‚è€Œ Terraform å¹¶ä¸çŸ¥é“è¿™äº›éšå«çš„ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½åœ¨è¯•å›¾ç»´æŠ¤ä¸€ä¸ªæ³¨å®šä¼šè¢«æ‰“ç ´çš„å¹³è¡¡ã€‚</p><p>å¯¹äº Inspector å’Œ ECR çš„æ¡ˆä¾‹ï¼Œæˆ‘æ¨æµ‹ï¼š</p><ul><li>AWS Inspector å¯èƒ½è®¤ä¸ºï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•â€å¢å¼ºâ€æ‰«æä»»åŠ¡ï¼Œå®ƒå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦</li><li>åŒæ ·ï¼Œå½“ Inspector è¢«æ¿€æ´»æ—¶ï¼Œå®ƒå¯èƒ½é»˜è®¤å°† ECR æ‰«æè®¾ä¸ºå¢å¼ºæ¨¡å¼ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ‰§è¡Œå…¶åŠŸèƒ½</li></ul><p>ä½†è¿™ç§â€è‡ªä½œä¸»å¼ â€çš„è¡Œä¸ºå¯¹äºä½¿ç”¨å£°æ˜å¼é…ç½®ç®¡ç†çš„ç”¨æˆ·æ¥è¯´ç®€ç›´æ˜¯å™©æ¢¦ï¼Œå› ä¸ºæˆ‘ä»¬æœŸæœ›çš„æ˜¯å¯é¢„æµ‹ã€ç¨³å®šçš„çŠ¶æ€ç®¡ç†ã€‚</p><h2 id=solution>5. solution</h2><p>æ—¢ç„¶ä¸¤ä¸ªçŠ¶æ€ç›´æ¥ä¼šæœ‰å…³è”ï¼Œé‚£å°±åªç•™ä¸€ä¸ªæ¥ç®¡ç†èµ„æºï¼Œè¿™æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚äºæ˜¯æˆ‘çš„ä»£ç å˜æˆäº†è¿™æ ·</p><figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br><span class=line>33</span><br><span class=line>34</span><br><span class=line>35</span><br></pre></td><td class=code><pre><span class=line># ğŸš« è­¦å‘Š: ä¸è¦æ‰‹åŠ¨å¯ç”¨ Inspector!</span><br><span class=line># 1. å¯ç”¨ Inspector ä¼šå¯¼è‡´å¯¹æ‰€æœ‰èµ„æºè¿›è¡Œæ‰«æï¼Œäº§ç”Ÿæ„å¤–è´¹ç”¨</span><br><span class=line># 2. æ‰‹åŠ¨æ¿€æ´»å¯èƒ½å¯¼è‡´ä¸ Terraform ç®¡ç†çš„çŠ¶æ€ä¸ä¸€è‡´</span><br><span class=line># resource &quot;aws_inspector2_enabler&quot; &quot;this&quot; &#123;</span><br><span class=line>#   account_ids    = [local.account_id]</span><br><span class=line>#   resource_types = [&quot;ECR&quot;]</span><br><span class=line>#   lifecycle &#123;</span><br><span class=line>#     prevent_destroy = true</span><br><span class=line>#   &#125;</span><br><span class=line># &#125;</span><br><span class=line></span><br><span class=line>locals &#123;</span><br><span class=line>  # æ ¹æ®å˜é‡å†³å®šæ‰«æç±»å‹</span><br><span class=line>  scan_type = var.enable_enhanced_scanning ? &quot;ENHANCED&quot; : &quot;BASIC&quot;</span><br><span class=line></span><br><span class=line>  # å¦‚æœå¯ç”¨å¢å¼ºæ‰«æï¼Œåˆ™æ‰«æç‰¹å®šä»“åº“ï¼Œå¦åˆ™æ‰«æå…¨éƒ¨</span><br><span class=line>  scan_repositories = (var.enable_enhanced_scanning ?</span><br><span class=line>    [for repo in var.repositories_to_scan : &quot;$&#123;var.registry_prefix&#125;/$&#123;repo&#125;&quot;] : [&quot;*&quot;])</span><br><span class=line>&#125;</span><br><span class=line></span><br><span class=line># åªç®¡ç† ECR æ‰«æé…ç½®</span><br><span class=line>resource &quot;aws_ecr_registry_scanning_configuration&quot; &quot;configuration&quot; &#123;</span><br><span class=line>  scan_type = local.scan_type</span><br><span class=line></span><br><span class=line>  dynamic &quot;rule&quot; &#123;</span><br><span class=line>    for_each = local.scan_repositories</span><br><span class=line>    content &#123;</span><br><span class=line>      scan_frequency = var.scan_frequency</span><br><span class=line>      repository_filter &#123;</span><br><span class=line>        filter      = rule.value</span><br><span class=line>        filter_type = &quot;WILDCARD&quot;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;</span><br><span class=line>  &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘çš„è§£å†³æ–¹æ¡ˆåŸºäºä¸€ä¸ªå…³é”®æ´å¯Ÿï¼š<strong>é—®é¢˜çš„æ ¹æºä¸æ˜¯ ECR é…ç½®ï¼Œè€Œæ˜¯ Terraform è¯•å›¾ç®¡ç† Inspector èµ„æº</strong>ã€‚é€šè¿‡é‡‡å–ä»¥ä¸‹ç­–ç•¥ï¼Œæˆ‘æˆåŠŸæ‰“ç ´äº†å¾ªç¯ï¼š</p><ol type=1><li><p><strong>å®Œå…¨æ³¨é‡Šæ‰ Inspector èµ„æº</strong>ï¼šä¸å†å°è¯•ç®¡ç† <code>aws_inspector2_enabler</code>ï¼Œé¿å…äº†ä¸ AWS è‡ªåŠ¨è¡Œä¸ºçš„å†²çªã€‚</p></li><li><p><strong>ä¸“æ³¨äºç®¡ç† ECR æ‰«æé…ç½®</strong>ï¼šåªé€šè¿‡ <code>aws_ecr_registry_scanning_configuration</code> èµ„æºæ¥æ§åˆ¶æ‰«æè¡Œä¸ºã€‚</p></li><li><p><strong>åŠ¨æ€è®¾ç½®æ‰«æèŒƒå›´</strong>ï¼š</p><ul><li>å½“è®¾ç½®ä¸º BASIC æ‰«ææ—¶ï¼Œä½¿ç”¨é€šé…ç¬¦ <code>"*"</code> è¦†ç›–æ‰€æœ‰ä»“åº“</li><li>å½“è®¾ç½®ä¸º ENHANCED æ‰«ææ—¶ï¼Œå¯ä»¥ç²¾ç¡®æŒ‡å®šéœ€è¦æ‰«æçš„ä»“åº“åˆ—è¡¨</li></ul></li><li><p><strong>æ¸…æ™°çš„è­¦å‘Šæ³¨é‡Š</strong>ï¼šæé†’å›¢é˜Ÿæˆå‘˜ä¸è¦æ‰‹åŠ¨å¯ç”¨ Inspectorï¼Œé¿å…å†æ¬¡é™·å…¥çŠ¶æ€é—®é¢˜ã€‚</p></li></ol><h3 id=è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿>è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜åŠ¿</h3><ol type=1><li><p><strong>ç¨³å®šå¯é </strong>ï¼šæ²¡æœ‰äº†çŠ¶æ€å¾ªç¯ï¼ŒTerraform çš„è¡Œä¸ºå˜å¾—å¯é¢„æµ‹ã€‚</p></li><li><p><strong>ä¿æŒçµæ´»æ€§</strong>ï¼šä»ç„¶å¯ä»¥é€šè¿‡å˜é‡æ§åˆ¶æ˜¯å¦å¯ç”¨å¢å¼ºæ‰«æã€‚</p></li><li><p><strong>æˆæœ¬æ§åˆ¶</strong>ï¼šé€šè¿‡ç²¾ç¡®æŒ‡å®šéœ€è¦å¢å¼ºæ‰«æçš„ä»“åº“ï¼Œé¿å…ä¸å¿…è¦çš„å¼€é”€ã€‚</p></li><li><p><strong>æ— éœ€æ‹…å¿ƒ Inspector çŠ¶æ€</strong>ï¼šè®© AWS è‡ªè¡Œç®¡ç† Inspector çš„åˆ›å»ºå’Œé”€æ¯ï¼Œä¸å†å°è¯•å¹²é¢„è¿™ä¸ªè¿‡ç¨‹ã€‚</p></li></ol><h3 id=å®é™…åº”ç”¨æ•ˆæœ>å®é™…åº”ç”¨æ•ˆæœ</h3><p>åœ¨å®æ–½è¿™ä¸ªæ–¹æ¡ˆåï¼Œæˆ‘å‘ç° Terraform çš„è¡Œä¸ºå˜å¾—æå…¶ç¨³å®šã€‚æ— è®ºè¿è¡Œå¤šå°‘æ¬¡ <code>apply</code>ï¼ŒçŠ¶æ€éƒ½ä¿æŒä¸€è‡´ï¼Œä¸å†æœ‰ä»»ä½•å¥‡æ€ªçš„å¾ªç¯æˆ–æ¼‚ç§»ã€‚</p><p>å½“æˆ‘å°† <code>enable_enhanced_scanning</code> è®¾ä¸º <code>false</code> æ—¶ï¼Œæ‰«æç±»å‹å˜ä¸º BASICï¼ŒAWS ä¼šè‡ªåŠ¨åœç”¨ Inspectorï¼ˆå› ä¸ºæ²¡æœ‰ä½¿ç”¨å®ƒçš„å¿…è¦ï¼‰ã€‚å½“æˆ‘å°†å…¶è®¾ä¸º <code>true</code> æ—¶ï¼ŒAWS ä¼šè‡ªåŠ¨åˆ›å»º Inspector å¹¶å¼€å§‹å¯¹æŒ‡å®šçš„ä»“åº“è¿›è¡Œå¢å¼ºæ‰«æã€‚</p><p>è¿™ç§æ–¹å¼ä¸ AWS çš„å†…éƒ¨é€»è¾‘å®Œç¾å¥‘åˆï¼Œä¸å†è¯•å›¾å¯¹æŠ— AWS çš„è‡ªåŠ¨è¡Œä¸ºï¼Œè€Œæ˜¯é¡ºåº”å®ƒï¼Œè®©ç³»ç»Ÿè‡ªç„¶è¿è¡Œã€‚</p><h2 id=sum-up>6. Sum up</h2><p>è¿™ä¸ªå‘ç°è®©æˆ‘æ„è¯†åˆ°ï¼Œ<strong>AWS æœåŠ¡é—´å¯èƒ½å­˜åœ¨å¤§é‡æˆ‘ä»¬ä¸äº†è§£çš„éšæ€§å…³è”å’Œè‡ªåŠ¨è¡Œä¸º</strong>ã€‚è¿™äº›â€å¹•åè¡Œä¸ºâ€ä¸ä¸€å®šåœ¨æ–‡æ¡£ä¸­å†™å¾—å¾ˆæ¸…æ¥šï¼Œä½†ä¼šæå¤§åœ°å½±å“æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ç®¡ç†ã€‚ç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨ Terraform è¿™ç±» IaC å·¥å…·æ—¶ï¼Œè¿™äº›éšæ€§ä¾èµ–ä¼šå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€å¾ªç¯å˜æ›´ç­‰é—®é¢˜ã€‚</p></div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>Post author: </strong>å‘¨å¤§ä¾ </li><li class=post-copyright-link><strong>Post link: </strong><a href=https://lifeodyssey.github.io/posts/ca51402d.html title="ç ´è§£ AWS Inspector ä¸ ECR çš„éšè—å…³è”ï¼šè§£å†³ Terraform ç®¡ç†çš„å¾ªç¯å›°å¢ƒ">https://lifeodyssey.github.io/posts/ca51402d.html</a></li><li class=post-copyright-license><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class=exturl data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9lbg=="><i class="fa-fw fab fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.</li></ul></div><div class=post-tags><a href=/tags/AWS/ rel=tag># AWS</a> <a href=/tags/DevOps/ rel=tag># DevOps</a> <a href=/tags/Software-Engineering/ rel=tag># Software Engineering</a></div><div class=post-nav><div class=post-nav-item><a href=/posts/aec625cb.html rel=prev title="Evaluating ChatGPTo1-preview, and Claude 3.5 sonnet"><i class="fa fa-angle-left"></i> Evaluating ChatGPTo1-preview, and Claude 3.5 sonnet</a></div><div class=post-nav-item><a href=/posts/ad479b93.html rel=next title=ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®çµŒé¨“ã¨æœªæ¥>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®çµŒé¨“ã¨æœªæ¥ <i class="fa fa-angle-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy; 2016 â€“ <span itemprop=copyrightYear>2025</span> <span class=with-love><i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>å‘¨å¤§ä¾ </span></div><div class=wordcount><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-chart-line"></i> </span><span title="Word count total">794k</span> </span><span class=post-meta-item><span class=post-meta-item-icon><i class="fa fa-coffee"></i> </span><span title="Reading time total">48:07</span></span></div><div class=powered-by>Powered by <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9taXN0Lw==">NexT.Mist</span></div></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span> <span class=toggle-line></span> <span class=toggle-line></span></div><div class=sidebar-dimmer></div><div class=back-to-top role=button aria-label="Back to top"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class=reading-progress-bar></div><a class="book-mark-link book-mark-link-fixed" role=button></a> <span class="exturl github-corner" data-url=aHR0cHM6Ly9naXRodWIuY29tL2xpZmVvZHlzc2V5 title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg aria-hidden=true height=80 viewBox="0 0 250 250" width=80><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" class=octo-arm fill=currentColor style="transform-origin:130px 106px"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" class=octo-body fill=currentColor></path></svg></span><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript></body></html>